(window.webpackJsonp=window.webpackJsonp||[]).push([[456],{864:function(e,t,s){"use strict";s.r(t);var a=s(46),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"simple-summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple summary")]),e._v(" "),s("p",[e._v("This proposal describes a communication protocol between dapps and Ethereum-enabled DOM environments that allows the Ethereum-enabled DOM environment to choose what information to supply the dapp with and when.")]),e._v(" "),s("h2",{attrs:{id:"abstract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),s("p",[e._v("The previous generation of Ethereum-enabled DOM environments follows a pattern of injecting a provider populated with accounts without user consent. This puts users of such environments at risk because malicious websites can use these accounts to view detailed account information and to arbitrarily initiate unwanted transactions on a user's behalf.")]),e._v(" "),s("p",[e._v("This proposal outlines a protocol in which Ethereum-enabled DOM environments can choose to expose no accounts until the user approves account access.")]),e._v(" "),s("h2",{attrs:{id:"specification"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),s("h3",{attrs:{id:"concepts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#concepts"}},[e._v("#")]),e._v(" Concepts")]),e._v(" "),s("h4",{attrs:{id:"rfc-2119"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rfc-2119"}},[e._v("#")]),e._v(" RFC-2119")]),e._v(" "),s("p",[e._v('The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in '),s("a",{attrs:{href:"https://www.ietf.org/rfc/rfc2119.txt",target:"_blank",rel:"noopener noreferrer"}},[e._v("RFC-2119"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h4",{attrs:{id:"eth-requestaccounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eth-requestaccounts"}},[e._v("#")]),e._v(" "),s("code",[e._v("eth_requestAccounts")])]),e._v(" "),s("p",[e._v("Providers exposed by Ethereum-enabled DOM environments define a new RPC method: "),s("code",[e._v("eth_requestAccounts")]),e._v(". Calling this method may trigger a user interface that allows the user to approve or reject account access for a given dapp. This method returns a "),s("code",[e._v("Promise")]),e._v(" that is resolved with an "),s("code",[e._v("Array")]),e._v(" of accounts or is rejected with an "),s("code",[e._v("Error")]),e._v(" if accounts are not available.")]),e._v(" "),s("div",{staticClass:"language-typescript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[e._v("ethereum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_requestAccounts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Promise")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Array")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"provider-enable-deprecated"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#provider-enable-deprecated"}},[e._v("#")]),e._v(" Provider#enable (DEPRECATED)")]),e._v(" "),s("p",[s("strong",[e._v("Note: This method is deprecated in favor of the RPC method "),s("a",{attrs:{href:"#eth_requestaccounts"}},[s("code",[e._v("eth_requestAccounts")])]),e._v(".")])]),e._v(" "),s("p",[e._v("Providers exposed by Ethereum-enabled DOM environments define a new RPC method: "),s("code",[e._v("ethereum.enable()")]),e._v(". Calling this method triggers a user interface that allows the user to approve or reject account access for a given dapp. This method returns a "),s("code",[e._v("Promise")]),e._v(" that is resolved with an "),s("code",[e._v("Array")]),e._v(" of accounts if the user approves access or rejected with an "),s("code",[e._v("Error")]),e._v(" if the user rejects access.")]),e._v(" "),s("div",{staticClass:"language-typescript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[e._v("ethereum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Promise")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"protocol"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#protocol"}},[e._v("#")]),e._v(" Protocol")]),e._v(" "),s("h4",{attrs:{id:"legacy-dapp-initialization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#legacy-dapp-initialization"}},[e._v("#")]),e._v(" Legacy dapp initialization")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("START dapp\nIF web3 is defined\n    CONTINUE dapp\nIF web3 is undefined\n    STOP dapp\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h4",{attrs:{id:"proposed-dapp-initialization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proposed-dapp-initialization"}},[e._v("#")]),e._v(" Proposed dapp initialization")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("START dapp\nIF provider is defined\n    REQUEST[1] account access\n    IF user approves\n        RESOLVE[2] account access\n        CONTINUE dapp\n    IF user rejects\n        REJECT[3] account access\n        STOP dapp\nIF provider is undefined\n    STOP dapp\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("h5",{attrs:{id:"_1-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-request"}},[e._v("#")]),e._v(" "),s("code",[e._v("[1] REQUEST")])]),e._v(" "),s("p",[e._v("Dapps "),s("strong",[e._v("MUST")]),e._v(" request accounts by calling the "),s("code",[e._v("eth_requestAccounts")]),e._v(" RPC method on the provider exposed at "),s("code",[e._v("window.ethereum")]),e._v(". Calling this method "),s("strong",[e._v("MAY")]),e._v(" trigger a user interface that allows the user to approve or reject account access for a given dapp. This method "),s("strong",[e._v("MUST")]),e._v(" return a "),s("code",[e._v("Promise")]),e._v(" that is resolved with an array of one or more user accounts or rejected if no accounts are available (e.g., the user rejected account access).")]),e._v(" "),s("h5",{attrs:{id:"_2-resolve"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-resolve"}},[e._v("#")]),e._v(" "),s("code",[e._v("[2] RESOLVE")])]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("Promise")]),e._v(" returned when calling the "),s("code",[e._v("eth_requestAccounts")]),e._v(" RPC method "),s("strong",[e._v("MUST")]),e._v(" be resolved with an "),s("code",[e._v("Array")]),e._v(" of user accounts.")]),e._v(" "),s("h5",{attrs:{id:"_3-reject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-reject"}},[e._v("#")]),e._v(" "),s("code",[e._v("[3] REJECT")])]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("Promise")]),e._v(" returned when calling the "),s("code",[e._v("eth_requestAccounts")]),e._v(" RPC method "),s("strong",[e._v("MUST")]),e._v(" be rejected with an informative "),s("code",[e._v("Error")]),e._v(" if no accounts are available for any reason.")]),e._v(" "),s("h3",{attrs:{id:"example-initialization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#example-initialization"}},[e._v("#")]),e._v(" Example initialization")]),e._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("try")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Request account access if needed")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" accounts "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" ethereum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_requestAccounts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Accounts now exposed, use them")]),e._v("\n    ethereum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_sendTransaction'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" from"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" accounts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/* ... */")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("catch")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// User denied account access")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h3",{attrs:{id:"constraints"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#constraints"}},[e._v("#")]),e._v(" Constraints")]),e._v(" "),s("ul",[s("li",[e._v("Browsers "),s("strong",[e._v("MUST")]),e._v(" expose a provider at "),s("code",[e._v("window.ethereum")]),e._v(" .")]),e._v(" "),s("li",[e._v("Browsers "),s("strong",[e._v("MUST")]),e._v(" define an "),s("code",[e._v("eth_requestAccounts")]),e._v(" RPC method.")]),e._v(" "),s("li",[e._v("Browsers "),s("strong",[e._v("MAY")]),e._v(" wait for a user interaction before resolving/rejecting the "),s("code",[e._v("eth_requestAccounts")]),e._v(" promise.")]),e._v(" "),s("li",[e._v("Browsers "),s("strong",[e._v("MUST")]),e._v(" include at least one account if the "),s("code",[e._v("eth_requestAccounts")]),e._v(" promise is resolved.")]),e._v(" "),s("li",[e._v("Browsers "),s("strong",[e._v("MUST")]),e._v(" reject the promise with an informative error if no accounts are available.")])]),e._v(" "),s("h2",{attrs:{id:"rationale"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),s("p",[e._v("The pattern of automatic account exposure followed by the previous generation of Ethereum-enabled DOM environments fails to protect user privacy and fails to maintain safe user experience: untrusted websites can both view detailed account information and arbitrarily initiate transactions on a user's behalf. Even though most users may reject unsolicited transactions on untrusted websites, a protocol for account access should make such unsolicited requests impossible.")]),e._v(" "),s("p",[e._v("This proposal establishes a new pattern wherein dapps must request access to user accounts. This protocol directly strengthens user privacy by allowing the browser to hide user accounts and preventing unsolicited transaction requests on untrusted sites.")]),e._v(" "),s("h3",{attrs:{id:"immediate-value-add"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#immediate-value-add"}},[e._v("#")]),e._v(" Immediate value-add")]),e._v(" "),s("ul",[s("li",[e._v("Users can reject account access on untrusted sites to hide accounts.")]),e._v(" "),s("li",[e._v("Users can reject account access on untrusted sites to prevent unsolicited transactions.")])]),e._v(" "),s("h3",{attrs:{id:"long-term-value-add"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#long-term-value-add"}},[e._v("#")]),e._v(" Long-term value-add")]),e._v(" "),s("ul",[s("li",[e._v("Dapps could request specific account information based on user consent.")]),e._v(" "),s("li",[e._v("Dapps could request specific user information based on user consent (uPort, DIDs).")]),e._v(" "),s("li",[e._v("Dapps could request a specific network based on user consent.")]),e._v(" "),s("li",[e._v("Dapps could request multiple instances of the above based on user consent.")])]),e._v(" "),s("h2",{attrs:{id:"backwards-compatibility"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards compatibility")]),e._v(" "),s("p",[e._v("This proposal impacts dapp developers and requires that they request access to user accounts following the protocol outlined above. Similarly, this proposal impacts dapp browser developers and requires that they only expose user accounts following the protocol defined above.")]),e._v(" "),s("h2",{attrs:{id:"implementation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[e._v("#")]),e._v(" Implementation")]),e._v(" "),s("p",[e._v("The MetaMask team "),s("a",{attrs:{href:"https://github.com/MetaMask/metamask-extension/pull/4703",target:"_blank",rel:"noopener noreferrer"}},[e._v("has implemented"),s("OutboundLink")],1),e._v(" the strategy described above.")]),e._v(" "),s("h2",{attrs:{id:"copyright"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),s("p",[e._v("Copyright and related rights waived via "),s("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CC0"),s("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=r.exports}}]);