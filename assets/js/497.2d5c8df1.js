(window.webpackJsonp=window.webpackJsonp||[]).push([[497],{906:function(e,t,a){"use strict";a.r(t);var o=a(46),n=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple Summary")]),e._v(" "),a("p",[e._v("At each block, deduct an amount of value from every account based on the quantity of storage used by that account.")]),e._v(" "),a("h1",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v("The most naive implementation would be to simply loop through every account on each block and deduct a certain fee. We show that a better implementation could achieve reasonable performance. Also we review practical considerations of switching to a fee-based rent system.")]),e._v(" "),a("p",[e._v("In other words, "),a("code",[e._v("product=0; while(factor1--)product+= factor2;")]),e._v(" is slow, but equivalently "),a("code",[e._v("product = factor1 * factor2")]),e._v(" is fast. And we can reason about both at the same time.")]),e._v(" "),a("h1",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("p",[e._v("Ethereum is a public utility and we are underpricing the long-term costs of storage. Storage cost can be approximately modeled as bytes × time.")]),e._v(" "),a("h1",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("p",[a("strong",[e._v("New state variables (per account)")])]),e._v(" "),a("ul",[a("li",[e._v("rent -- σ[a]_r -- an amount of value, in Wei")]),e._v(" "),a("li",[e._v("rentLastPaid -- σ[a]_p -- a block number that is set when:\n"),a("ul",[a("li",[e._v("Value is transferred into an account")]),e._v(" "),a("li",[e._v("Code is set for an account (CREATE)")]),e._v(" "),a("li",[e._v("An account's storage is updated (SSTORE)")])])]),e._v(" "),a("li",[e._v("storageWords -- σ[a]_w -- number of words in storage")]),e._v(" "),a("li",[e._v("rentEvictBlock -- σ[a]_e -- the block number when this account will be destructed\n"),a("ul",[a("li",[e._v("Note: it is possible that a client could implement the Yellow Paper without storing this value explicitly. It can be calculated simply on demand.")])])])]),e._v(" "),a("p",[a("strong",[e._v("New constants")])]),e._v(" "),a("ul",[a("li",[e._v("RENT_WORD_COST -- The rent cost, in Wei, paid for each word-block")]),e._v(" "),a("li",[e._v("RENT_ACCOUNT_COST -- The rent cost, in Wei, paid for each account-block")]),e._v(" "),a("li",[e._v("RENT_STIPEND -- The amount of rent, in Wei, given to accounts when touched")])]),e._v(" "),a("p",[a("strong",[e._v("New opcodes")])]),e._v(" "),a("ul",[a("li",[e._v("RENTBALANCE(address) -- G_BALANCE -- Similar to BALANCE")]),e._v(" "),a("li",[e._v("SENDRENT(address, amount) -- G_BASE -- Convert value to rent and send to account\n"),a("ol",[a("li",[e._v("σ[account]_rent += amount")]),e._v(" "),a("li",[e._v("σ[msg.sender]_balance -= amount")])])])]),e._v(" "),a("p",[a("strong",[e._v("Updated opcodes")])]),e._v(" "),a("p",[e._v("A new subroutine, paying for rent, is established as such:")]),e._v(" "),a("div",{staticClass:"language-pseudocode line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("PAYRENT(account)\n    ASSERT(σ[account]_rentEviction >= NUMBER) // TODO: I'm not sure if should be > or >=\n    blocks_to_pay = NUMBER - σ[account]_rentLastPaid\n    cost_per_block = RENT_ACCOUNT_COST + RENT_WORD_COST * ⌈∥σ[account]_code∥ / 32⌉ + RENT_WORD_COST * σ[a]_storageWords\n    rent_to_pay = blocks_to_pay * cost_per_block\n    σ[account]_rent -= rent_to_pay\n    σ[account]_rentLastPaid = NUMBER\n    σ[account]_rentEvictBlock = NUMBER + ⌊σ[account]_rent / cost_per_block⌋\nEND PAYRENT\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("ul",[a("li",[e._v("SSTORE(account, key, value)\n"),a("ul",[a("li",[e._v("Perform PAYRENT(account)")]),e._v(" "),a("li",[e._v("Set σ[account]_rent = MAX(σ[account]_rent, RENT_STIPEND)")]),e._v(" "),a("li",[e._v("Do normal SSTORE operation")]),e._v(" "),a("li",[e._v("If the old value was zero for this [account, key] and the new value is non-zero, then σ[account]_storageSize++")]),e._v(" "),a("li",[e._v("If the old value was non-zero for this [account, key] and the new value is zero, then σ[account]_storageSize--")])])]),e._v(" "),a("li",[e._v("CALL (and derivatives)\n"),a("ul",[a("li",[e._v("If value > 0 then perform PAYRENT(account)")]),e._v(" "),a("li",[e._v("Do normal CALL operation")])])]),e._v(" "),a("li",[e._v("CREATE\n"),a("ul",[a("li",[e._v("Set σ[account]_rent = MAX(σ[account]_rent, RENT_STIPEND)")]),e._v(" "),a("li",[e._v("Set σ[account]_rentLastPaid = HEIGHT")]),e._v(" "),a("li",[e._v("Do normal CREATE operation")]),e._v(" "),a("li",[e._v("Note: it is possible there is a pre-existing rent balance here")])])])]),e._v(" "),a("p",[a("strong",[e._v("Updated substate")])]),e._v(" "),a("p",[e._v("The substate tuple is defined as:")]),e._v(" "),a("blockquote",[a("p",[e._v("A ≡ (As, Al, At, Ar)")])]),e._v(" "),a("p",[e._v('This includes A_t, "the set of touched accounts, of which the empty ones are deleted at the end of a transaction".')]),e._v(" "),a("p",[e._v('This definition is updated to: "the set of touched accounts, of which the empty ones or evicted ones (BLOCK >= σ[a]_rentEvictBlock) are deleted at the end of a transaction"')]),e._v(" "),a("p",[e._v("// TODO: I'm not sure if that should be > or >=")]),e._v(" "),a("p",[a("strong",[e._v("New built-in contract")])]),e._v(" "),a("ul",[a("li",[e._v("PAYRENT(address, amount) -- Calls PAYRENT opcode")])]),e._v(" "),a("p",[a("em",[e._v("This is a convenience for humans to send Ether from their accounts and turn it into rent. Note that simple accounts (CODESIZE == 0) cannot call arbitrary opcodes, they can only call CREATE or CALL.")])]),e._v(" "),a("p",[e._v("The gas cost of PAYRENT will be 10,000.")]),e._v(" "),a("p",[a("strong",[e._v("No changes to current opcode gas costs.")])]),e._v(" "),a("h1",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),a("p",[a("strong",[e._v("No call")])]),e._v(" "),a("p",[e._v("A contract will not know or react to the receipt of rent. This is okay. Workaround: if a contract really needed to know who provided rent payments then it could create a function in its ABI to attribute these payments. It is already possible to send payments to a contract without attribution by using SELFDESTRUCT.")]),e._v(" "),a("p",[a("strong",[e._v("Eviction responsibility / lazy evaluation")])]),e._v(" "),a("p",[e._v("The specification gives responsibility for eviction to the consensus clients. This is the most predictable behavior because it happens exactly when it should. Also there need not be any incentive mechanism (refund gas, bounty) for outside participants (off chain) to monitor accounts and request removal.")]),e._v(" "),a("p",[e._v("This adds a computational responsibility to the clients to track eviction dates. This is possible in efficient time (at double the memory) using a double-ended priority queue (one for addressing by account address, the other for addressing by eviction date). There may be other ways of implementing this with different time-memory guarantees.")]),e._v(" "),a("p",[a("strong",[e._v("No converting rent to value")])]),e._v(" "),a("p",[e._v("Ether converted to rent cannot be converted back. Anybody that works in accounting and knows about gifts cards should tell you this is a good idea. It makes reasoning about the system much easier.")]),e._v(" "),a("p",[a("strong",[e._v("Accounts pay rent")])]),e._v(" "),a("p",[e._v("Yes, they pay rent. It costs money to keep their balances so we charge them rent.")]),e._v(" "),a("p",[a("strong",[e._v("Shouldn't we spend value (Ether balance) when rent is depleted?")])]),e._v(" "),a("p",[e._v("Yes.")]),e._v(" "),a("ul",[a("li",[e._v("Rename "),a("code",[e._v("rentEvictBlock")]),e._v(" to "),a("code",[e._v("rentUsingValueBlock")])]),e._v(" "),a("li",[e._v("Update eviction calculation to include "),a("code",[e._v("RENT")]),e._v(" + "),a("code",[e._v("VALUE")]),e._v(". Also update "),a("code",[e._v("CALL")]),e._v(" (and friends) operations to recalculate eviction date when value is transferred. This is the new "),a("code",[e._v("rentEvictBlock")]),e._v(".")]),e._v(" "),a("li",[e._v("Update "),a("code",[e._v("CALL")]),e._v(" (and friends), "),a("code",[e._v("RENTBALANCE")]),e._v(" and "),a("code",[e._v("SENDRENT")]),e._v(" operations. If "),a("code",[e._v("NUMBER")]),e._v(" >= "),a("code",[e._v("rentUsingValueBlock")]),e._v(" then proceed as if rent started paying using value.")])]),e._v(" "),a("p",[e._v("Conceptually, you understand how this change works. But putting the details above is a little complicated. So I like the informal definition above until we have some consent around it (do de this before this draft gets to LAST CALL).")]),e._v(" "),a("p",[a("strong",[e._v("Your contract can be evicted and disappeared")])]),e._v(" "),a("p",[e._v("Yes, if you do not pay rent for your account or contract then you lose it all. User education is required.")]),e._v(" "),a("p",[e._v("Actually, we should spend value (Ether balance) when rent is depleted.")]),e._v(" "),a("p",[a("strong",[e._v("Why do you need a separate rent account?")])]),e._v(" "),a("p",[e._v("Because anybody/everybody can contribute to the rent account. If you depend on a contract, you should be contributing to its rent.")]),e._v(" "),a("p",[e._v("But the contract can spend all of its value.")]),e._v(" "),a("p",[e._v("By maintaining a separate rent and value balance, this allows people to contribute to the rent while being confident that this is allowing the contract to stay around.")]),e._v(" "),a("p",[a("strong",[e._v("Permanent removal")])]),e._v(" "),a("p",[e._v("All state about an account is destructed during eviction. The data cannot be recovered. That's the point.")]),e._v(" "),a("p",[e._v("Hint to implementers: make sure this works:")]),e._v(" "),a("ol",[a("li",[e._v("Send value to a new account (gets stipend)")]),e._v(" "),a("li",[e._v("Pay rent to that account")]),e._v(" "),a("li",[e._v("Wait until after the rent expires (account is gone)")]),e._v(" "),a("li",[e._v("Send value to that account (gets stipend again)")]),e._v(" "),a("li",[e._v("Deploy a contract (CREATE) to that account (stipend gets topped off)")])]),e._v(" "),a("h1",{attrs:{id:"rationale-economics-constants"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale-economics-constants"}},[e._v("#")]),e._v(" Rationale -- economics & constants")]),e._v(" "),a("p",[e._v("An "),a("code",[e._v("SSTORE")]),e._v(" executed in 2015 cost 20,000 gas and has survived about 6 million blocks. The gas price has been around 1 ~ 50 Gwei. So basically 4,000 Wei per block per word so far. Maybe storing an account is 10 times more intensive than storing a word. But actually "),a("code",[e._v("G_transaction")]),e._v(" is 21,000 and "),a("code",[e._v("G_sstore")]),e._v(" is 20,000 so these are similar and they can both create new accounts / words.")]),e._v(" "),a("p",[e._v("How about:")]),e._v(" "),a("ul",[a("li",[e._v("RENT_WORD_COST -- 4,000 Wei")]),e._v(" "),a("li",[e._v("RENT_ACCOUNT_COST -- 4,000 Wei")]),e._v(" "),a("li",[e._v("RENT_STIPEND -- 4,000 Wei * 360 days worth of blocks")])]),e._v(" "),a("p",[e._v("The rent is priced in cold, hard Ether. It is not negotiated by clients, it is not dynamic. It is linear. Why is this a good idea? Because right now Ethereum is a system with multiple free variables -- Ether/gas price, gas/opcodes costs, Ether/block reward. [Add some note here about reducing a system of equations...] So the end result is that we can peg one of the values and it will be okay.")]),e._v(" "),a("p",[e._v("Q: There is a finite-ish amount of Ether and this proposal introduces a word-price in Ether, do math for me. A: The current size of Ethereum is about ~1 TB, maybe half of that is branch nodes. So that's like 15B words. There is about 100M Ether mined. The answer is that all the Ether can be spent on 400,000 terabyte-years of storage. I'm not sure if it is helpful to look at it that way.")]),e._v(" "),a("h1",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards compatibility")]),e._v(" "),a("p",[e._v("There is a 360-day transition period (related to the RENT_STIPEND). This requires a hard fork. On the block of the fork, every account is immediately funded with enough rent to pay for ~ 360 days' worth of their current storage requirements. The formal implementation is that this new rule is applied if any existing account has σ[account]_rentLastPaid = 0. Therefore this can be implemented by clients lazily or eagerly.")]),e._v(" "),a("p",[e._v("Preexisting accounts which increase their storage needs will evict sooner than 360 days.")]),e._v(" "),a("p",[e._v("Users will need to be educated.")]),e._v(" "),a("h1",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[e._v("#")]),e._v(" Test Cases")]),e._v(" "),a("p",[e._v("TO BE ADDED")]),e._v(" "),a("h1",{attrs:{id:"implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[e._v("#")]),e._v(" Implementation")]),e._v(" "),a("p",[e._v("TO BE ADDED")]),e._v(" "),a("h1",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("Copyright and related rights waived via CC0.")])])}),[],!1,null,null,null);t.default=n.exports}}]);