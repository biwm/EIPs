(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{349:function(t,a,e){t.exports=e.p+"assets/img/diamond.49e56369.svg"},350:function(t,a,e){t.exports=e.p+"assets/img/DiamondDiagram.ec61bc64.png"},351:function(t,a,e){t.exports=e.p+"assets/img/diamondstorage1.d4bd3d2d.png"},352:function(t,a,e){t.exports=e.p+"assets/img/facetreuse.8c0a2776.png"},646:function(t,a,e){"use strict";e.r(a);var n=e(46),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("img",{attrs:{align:"right",src:e(349),width:"230",height:"230"}}),t._v(" "),n("h2",{attrs:{id:"simple-summary"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[t._v("#")]),t._v(" Simple Summary")]),t._v(" "),n("p",[t._v("Standard for building modular smart contract systems that can be extended in production.")]),t._v(" "),n("p",[t._v("Enables people to write smart contracts with virtually no size limit.")]),t._v(" "),n("p",[t._v("Diamonds can be upgraded without having to redeploy existing functionality. Parts of a diamond can be added/replaced/removed while leaving other parts alone.")]),t._v(" "),n("p",[t._v("Standardizes contract interfaces and implementation details of diamonds, enabling software integration and interoperability.")]),t._v(" "),n("p",[t._v("A diamond is a contract that implements the Specification in this standard.")]),t._v(" "),n("p",[t._v("Diamond analogy helps conceptualize development.")]),t._v(" "),n("h2",{attrs:{id:"motivation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[t._v("#")]),t._v(" Motivation")]),t._v(" "),n("p",[t._v("There are a number of different reasons to use diamonds. Here are some of them:")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("A single address for unlimited contract functionality.")]),t._v(" Using a single address for contract functionality makes deployment, testing and integration with other smart contracts, software and user interfaces easier.")]),t._v(" "),n("li",[n("strong",[t._v("Your contract exceeds the 24KB maximum contract size.")]),t._v(" You may have related functionality that it makes sense to keep in a single contract, or at a single contract address. A diamond does not have a max contract size.")]),t._v(" "),n("li",[n("strong",[t._v("A diamond provides a way to organize contract code and data.")]),t._v(" You may want to build a contract system with a lot of functionality. A diamond provides a systematic way to isolate different functionality and connect them together and share data between them as needed in a gas-efficient way.")]),t._v(" "),n("li",[n("strong",[t._v("A diamond provides a way to upgrade functionality.")]),t._v(" Upgradeable diamonds can be upgraded to add/replace/remove functionality. Because diamonds have no max contract size, there is no limit to the amount of functionality that can be added to diamonds over time. Diamonds can be upgradeable or immutable. It is also possible to make an upgradeable diamond and then at a later time remove its upgrade capability.")])]),t._v(" "),n("h3",{attrs:{id:"diamonds-support-transparency"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamonds-support-transparency"}},[t._v("#")]),t._v(" Diamonds Support Transparency")]),t._v(" "),n("p",[t._v("To find out what functions a regular smart contract has it is only necessary to look at its verified source code.")]),t._v(" "),n("p",[t._v("The verified source code of a diamond does not include what functions it has so a different mechanism is needed.")]),t._v(" "),n("p",[t._v("A diamond has four standard functions called the loupe functions that are used to show what functions a diamond has.")]),t._v(" "),n("p",[t._v("The loupe functions can be used for many things including:")]),t._v(" "),n("ol",[n("li",[t._v("To show all functions used by a diamond.")]),t._v(" "),n("li",[t._v("To query services like Etherscan or files to retrieve and show all source code used by a diamond.")]),t._v(" "),n("li",[t._v("To query services like Etherscan or files to retrieve ABI information for a diamond.")]),t._v(" "),n("li",[t._v("To test or verify that a transaction that adds/replaces/removes functions on a diamond succeeded.")]),t._v(" "),n("li",[t._v("To find out what functions a diamond has before calling functions on it.")]),t._v(" "),n("li",[t._v("To be used by tools and programming libraries to deploy and upgrade diamonds.")]),t._v(" "),n("li",[t._v("To be used by user interfaces to show information about diamonds.")]),t._v(" "),n("li",[t._v("To be used by user interfaces to enable users to call functions on diamonds.")])]),t._v(" "),n("p",[t._v("Diamonds support another form of transparency which is a historical record of all upgrades on a diamond. This is done with the DiamondCut event which is used to record all functions that are added, replaced or removed on a diamond.")]),t._v(" "),n("p",[t._v("This standard is an improvement of "),n("a",{attrs:{href:"https://eips.ethereum.org/EIPS/eip-1538",target:"_blank",rel:"noopener noreferrer"}},[t._v("EIP-1538 Transparent Contract Standard"),n("OutboundLink")],1),t._v(". The same motivations of that standard apply to this standard.")]),t._v(" "),n("p",[t._v("See the "),n("a",{attrs:{href:"https://eips.ethereum.org/EIPS/eip-2535#learning--references",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learning & References section"),n("OutboundLink")],1),t._v(" for additional information and uses of diamonds.")]),t._v(" "),n("h2",{attrs:{id:"what-is-a-diamond"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#what-is-a-diamond"}},[t._v("#")]),t._v(" What is a Diamond?")]),t._v(" "),n("p",[t._v("A diamond is a contract with external functions that are supplied by contracts called "),n("strong",[t._v("facets")]),t._v(".")]),t._v(" "),n("p",[t._v("Facets are separate, independent contracts that can share internal functions, libraries and state variables.")]),t._v(" "),n("h2",{attrs:{id:"how-a-diamond-works"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-a-diamond-works"}},[t._v("#")]),t._v(" How a Diamond Works")]),t._v(" "),n("p",[t._v("A diamond stores within it a mapping of function selector to facet address, for example "),n("code",[t._v("selectorToFacet")]),t._v(".")]),t._v(" "),n("p",[t._v("When an external function is called on a diamond its fallback function is executed. The fallback function finds in the "),n("code",[t._v("selectorToFacet")]),t._v(" mapping which facet has the function that has been called and then executes that function from the facet using "),n("code",[t._v("delegatecall")]),t._v(".")]),t._v(" "),n("p",[t._v("A diamond's fallback function and "),n("code",[t._v("delegatecall")]),t._v(" enable a diamond to execute a facet's external function as its own external function. The "),n("code",[t._v("msg.sender")]),t._v(" and "),n("code",[t._v("msg.value")]),t._v(" values do not change and only the diamond's contract storage is read and written to.")]),t._v(" "),n("p",[t._v("Here is a simple example of a diamond's fallback function:")]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Find facet for function that is called and execute the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// function if a facet is found and return any value.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("payable")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get facet from function selector")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" facet "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" selectorTofacet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("facet "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Execute external function from facet using delegatecall and return any value.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assembly")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// copy function selector and any arguments")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("calldatacopy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("calldatasize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// execute function call using the facet")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delegatecall")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" facet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("calldatasize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get any return value")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("returndatacopy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("returndatasize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return any return value or error back to the caller")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" result\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("revert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("returndatasize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("returndatasize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br")])]),n("p",[t._v("A diamond can use a "),n("code",[t._v("diamondCut")]),t._v(" function to add/replace/remove any number of functions from any number of facets in a single transaction. "),n("code",[t._v("diamondCut")]),t._v(" updates the mapping of function selector to facet address. Other such functions can be used.")]),t._v(" "),n("p",[t._v("An event is emitted any time external functions are added, replaced or removed to report what changed.")]),t._v(" "),n("p",[t._v("A diamond has four standard external functions that can be called to show what facets and functions it currently has.")]),t._v(" "),n("h2",{attrs:{id:"upgrades-and-immutability"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upgrades-and-immutability"}},[t._v("#")]),t._v(" Upgrades and Immutability")]),t._v(" "),n("p",[t._v("A diamond can be immutable from inception by not adding any external functions that can add/replace/remove functions. "),n("a",{attrs:{href:"#different-kinds-of-diamonds"}},[t._v("There are number of reasons to do this.")])]),t._v(" "),n("p",[t._v("A diamond that is mutable can be made immutable by removing such functions.")]),t._v(" "),n("p",[t._v("A diamond can be upgraded if it has a diamondCut external function or other function(s) that can add/replace/remove functions.")]),t._v(" "),n("h2",{attrs:{id:"organizing-state-variables-in-diamonds"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#organizing-state-variables-in-diamonds"}},[t._v("#")]),t._v(" Organizing State Variables in Diamonds")]),t._v(" "),n("p",[t._v("A state variable or storage layout organizational pattern is needed because Solidity's builtin storage layout system doesn't support proxy contracts or diamonds.")]),t._v(" "),n("p",[t._v("Described below are Diamond Storage and AppStorage which are two state variable organizational patterns that have been successfully used in diamonds.")]),t._v(" "),n("p",[t._v("Another successful pattern has been to write a storage contract that contains all state variables and is inherited by all facets.")]),t._v(" "),n("h2",{attrs:{id:"facets-state-variables-and-diamond-storage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#facets-state-variables-and-diamond-storage"}},[t._v("#")]),t._v(" Facets, State Variables and Diamond Storage")]),t._v(" "),n("p",[t._v("A facet defines external functions and can define or use internal functions, libraries, and state variables.")]),t._v(" "),n("p",[t._v("A facet can declare state variables in structs. Each struct is given a specific position in contract storage. This technique is called "),n("strong",[t._v("Diamond Storage")]),t._v(".")]),t._v(" "),n("p",[t._v("Here is a simple example that shows Diamond Storage and its use in a facet:")]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A contract that implements Diamond Storage.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("library")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LibA")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This struct contains state variables we care about.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DiamondStorage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" owner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes32")]),t._v(" dataA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Returns the struct from a specified position in contract storage")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ds is short for DiamondStorage")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diamondStorage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("internal")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DiamondStorage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("storage")]),t._v(" ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Specifies a random position in contract storage")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This can be done with a keccak256 hash of a unique string as is")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// done here or other schemes can be used such as this: ")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bytes32 storagePosition = keccak256(abi.encodePacked(ERC1155.interfaceId, ERC1155.name, address(this)));")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes32")]),t._v(" storagePosition "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keccak256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"diamond.storage.LibA"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Set the position of our struct in contract storage")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assembly")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("slot "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" storagePosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Our facet uses the Diamond Storage defined above.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FacetA")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDataA")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes32")]),t._v(" _dataA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    LibA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DiamondStorage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("storage")]),t._v(" ds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LibA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diamondStorage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Must be owner."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataA "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _dataA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDataA")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LibA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diamondStorage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br")])]),n("p",[t._v("Any number of structs, each with a different storage position, can be used by a facet.")]),t._v(" "),n("p",[t._v("By using Diamond Storage facets can declare their own state variables that do not conflict with the storage locations of state variables declared in other facets.")]),t._v(" "),n("p",[t._v("By using Diamond Storage facets can be developed independently, without connection or concern for other facets.")]),t._v(" "),n("h2",{attrs:{id:"appstorage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#appstorage"}},[t._v("#")]),t._v(" AppStorage")]),t._v(" "),n("p",[t._v("A specialized version of Diamond Storage is AppStorage. This pattern is used to more conveniently and easily share state variables between facets.")]),t._v(" "),n("p",[t._v("The AppStorage pattern is implemented by defining a struct called AppStorage that contains the state variables of your application.  It can contain any number of state variables of any type, including arrays and mappings, and more can be added in upgrades.")]),t._v(" "),n("p",[t._v("The AppStorage struct is defined or imported and declared as the first and only state variable directly (or via inheritance) in any facet that uses it. This means that AppStorage is always located at position 0 in contract storage.")]),t._v(" "),n("p",[t._v("The AppStorage state variable is often named "),n("code",[t._v("s")]),t._v(" to provide easy access to it and to distinguish state variables from function arguments, function names, and local variables.")]),t._v(" "),n("p",[t._v("Here is a simple example of a contract that uses AppStorage:")]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./AppStorage.sol"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StakingFacet")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  AppStorage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("internal")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("myFacetFunction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _nextVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("total "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstVar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" _nextVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[t._v("The above example accesses the "),n("code",[t._v("s.firstVar")]),t._v(" state variable and stores a computation in the "),n("code",[t._v("s.total")]),t._v(" state variable.")]),t._v(" "),n("p",[t._v("Read this article to learn more about AppStorage: "),n("a",{attrs:{href:"https://dev.to/mudgen/appstorage-pattern-for-state-variables-in-solidity-3lki",target:"_blank",rel:"noopener noreferrer"}},[t._v("AppStorage Pattern for State Variables in Solidity"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"diamonds-can-use-other-contract-storage-strategies"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamonds-can-use-other-contract-storage-strategies"}},[t._v("#")]),t._v(" Diamonds Can Use Other Contract Storage Strategies")]),t._v(" "),n("p",[t._v("Diamonds and facets don't have to use Diamond Storage or AppStorage. They can use or mix with other contract storage strategies such as contract inheritance.")]),t._v(" "),n("p",[t._v("Diamonds only need to implement the "),n("a",{attrs:{href:"#specification"}},[t._v("Specification section")]),t._v(" of this standard.")]),t._v(" "),n("h2",{attrs:{id:"facets-can-share-state-and-functionality"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#facets-can-share-state-and-functionality"}},[t._v("#")]),t._v(" Facets Can Share State and Functionality")]),t._v(" "),n("p",[t._v("Facets can share state variables by using the same structs at the same storage positions.")]),t._v(" "),n("p",[t._v("Facets can share internal functions and libraries by inheriting the same contracts or using the same libraries.")]),t._v(" "),n("p",[t._v("In these ways facets are separate, independent units but can share state and functionality.")]),t._v(" "),n("h2",{attrs:{id:"facets-are-reusable-and-composable"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#facets-are-reusable-and-composable"}},[t._v("#")]),t._v(" Facets are Reusable and Composable")]),t._v(" "),n("p",[t._v("A deployed facet can be used by any number of diamonds.")]),t._v(" "),n("p",[t._v("Different combinations of facets can be used with different diamonds.")]),t._v(" "),n("p",[t._v("It is possible to create and deploy a set of facets that are reused by different diamonds over time.")]),t._v(" "),n("p",[t._v("The ability to use the same deployed facets for many diamonds reduces deployment costs.")]),t._v(" "),n("p",[t._v("A limitation is that two external functions with the same function signature can't be added to a diamond at the same time because a diamond, or any contract, cannot have two external functions with the same function signature.")]),t._v(" "),n("h2",{attrs:{id:"diagrams"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diagrams"}},[t._v("#")]),t._v(" Diagrams")]),t._v(" "),n("h3",{attrs:{id:"diamond-structure"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-structure"}},[t._v("#")]),t._v(" Diamond Structure")]),t._v(" "),n("p",[t._v("This diagram shows the structure of a diamond:")]),t._v(" "),n("img",{attrs:{src:e(350)}}),t._v(" "),n("h3",{attrs:{id:"diamond-storage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-storage"}},[t._v("#")]),t._v(" Diamond Storage")]),t._v(" "),n("p",[t._v("The diagram below shows facets with their own data and data shared between them.")]),t._v(" "),n("p",[t._v("Notice that all data is stored in the diamond. But different facets have different access to data.")]),t._v(" "),n("p",[t._v("In this diagram")]),t._v(" "),n("ul",[n("li",[t._v("Only FacetA can access DataA")]),t._v(" "),n("li",[t._v("Only FacetB can access DataB")]),t._v(" "),n("li",[t._v("Only the diamond's own code can access DataD.")]),t._v(" "),n("li",[t._v("FacetA and FacetB share access to DataAB.")]),t._v(" "),n("li",[t._v("The diamond's own code, FacetA and FacetB share access to DataABD.")])]),t._v(" "),n("img",{attrs:{src:e(351)}}),t._v(" "),n("h3",{attrs:{id:"deployed-facets-can-be-reused"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployed-facets-can-be-reused"}},[t._v("#")]),t._v(" Deployed Facets Can Be Reused")]),t._v(" "),n("p",[t._v("A deployed facet can be used by any number of diamonds.")]),t._v(" "),n("p",[t._v("The diagram below shows two diamonds using the same two facets.")]),t._v(" "),n("ul",[n("li",[t._v("FacetA is used by Diamond1")]),t._v(" "),n("li",[t._v("FacetA is used by Diamond2")]),t._v(" "),n("li",[t._v("FacetB is used by Diamond1")]),t._v(" "),n("li",[t._v("FacetB is used by Diamond2")])]),t._v(" "),n("img",{attrs:{src:e(352)}}),t._v(" "),n("h2",{attrs:{id:"some-diamond-benefits"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#some-diamond-benefits"}},[t._v("#")]),t._v(" Some Diamond Benefits")]),t._v(" "),n("ol",[n("li",[t._v("A stable contract address that provides needed functionality.")]),t._v(" "),n("li",[t._v("A single address with the functionality of multiple contracts (facets) that are independent from each other but can share internal functions, libraries and state variables.")]),t._v(" "),n("li",[t._v("A way to add, replace and remove multiple external functions atomically (in the same transaction).")]),t._v(" "),n("li",[t._v("Fine-grained upgrades, so you can change just the parts of a diamond that need to be changed.")]),t._v(" "),n("li",[t._v("Have greater control over when and what functions exist.")]),t._v(" "),n("li",[t._v("Decentralized Autonomous Organizations (DAOs) and other governance systems can be used to upgrade diamonds.")]),t._v(" "),n("li",[t._v("An event that shows what functions are added, replaced and removed.")]),t._v(" "),n("li",[t._v("The ability to show all changes made to a diamond.")]),t._v(" "),n("li",[t._v("Increase trust over time by showing all changes made to a diamond.")]),t._v(" "),n("li",[t._v("A way to look at a diamond to see its current facets and functions.")]),t._v(" "),n("li",[t._v("Have an immutable, trustless diamond.")]),t._v(" "),n("li",[t._v("Solves the 24KB maximum contract size limitation. Diamonds can be any size.")]),t._v(" "),n("li",[t._v("Separate functionality can be implemented in separate facets and used together in a diamond.")]),t._v(" "),n("li",[t._v("Larger contracts have to reduce their size by removing error messages and other things. You can keep your error messages and the full functionality that you need by implementing a diamond.")]),t._v(" "),n("li",[t._v("Enables zero, partial or full diamond immutability as desired, and when desired.")]),t._v(" "),n("li",[t._v("The ability to develop and improve an application over time with an upgradeable diamond and then make it immutable and trustless if desired.")]),t._v(" "),n("li",[t._v("Develop incrementally and let your diamond grow with your application.")]),t._v(" "),n("li",[t._v("Upgrade diamonds to fix bugs, add functionality and implement new standards.")]),t._v(" "),n("li",[t._v("Organize your code with a diamond and facets.")]),t._v(" "),n("li",[t._v("Diamonds can be large (have many functions) but still be modular because they are compartmented with facets.")]),t._v(" "),n("li",[t._v("Contract architectures that call multiple contracts in a single transaction can save gas by condensing those contracts into a single diamond and accessing state variables directly.")]),t._v(" "),n("li",[t._v("Save gas by creating external functions for specific use cases, such as bulk transfers.")]),t._v(" "),n("li",[t._v("Diamonds are designed for tooling and user-interface software.")])]),t._v(" "),n("h3",{attrs:{id:"new-user-interface-software-libraries"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#new-user-interface-software-libraries"}},[t._v("#")]),t._v(" New User-Interface Software & Libraries")]),t._v(" "),n("p",[t._v("User-interface software can be written to show all documentation, functions and source code used by a diamond.")]),t._v(" "),n("p",[t._v("Diamond events can be filtered from the Ethereum blockchain to show all changes to a diamond.")]),t._v(" "),n("p",[t._v("Existing and new programming libraries and software can be used to deploy, show, upgrade and use diamonds.")]),t._v(" "),n("h3",{attrs:{id:"upgradeable-diamond-vs-centralized-private-database"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upgradeable-diamond-vs-centralized-private-database"}},[t._v("#")]),t._v(" Upgradeable Diamond vs. Centralized Private Database")]),t._v(" "),n("p",[t._v("Why have an upgradeable diamond instead of a centralized, private, mutable database?")]),t._v(" "),n("ol",[n("li",[t._v("Decentralized Autonomous Organizations (DAOs) and other governance systems can be used to upgrade diamonds.")]),t._v(" "),n("li",[t._v("Wide interaction and integration with the Ethereum ecosystem.")]),t._v(" "),n("li",[t._v("With open storage data and verified source code it is possible to show a provable history of trustworthiness.")]),t._v(" "),n("li",[t._v("With openness bad behavior can be spotted and reported when it happens.")]),t._v(" "),n("li",[t._v("Independent security and domain experts can review the change history of contracts and vouch for their history of trustworthiness.")]),t._v(" "),n("li",[t._v("It is possible for an upgradeable diamond to become immutable and trustless.")])]),t._v(" "),n("h3",{attrs:{id:"different-kinds-of-diamonds"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#different-kinds-of-diamonds"}},[t._v("#")]),t._v(" Different Kinds of Diamonds")]),t._v(" "),n("p",[t._v("Many designs of diamonds are possible. Here are a few kinds of diamonds and their uses.")]),t._v(" "),n("p",[n("strong",[t._v("Upgradeable Diamond")]),t._v("\nAn upgradeable diamond has the "),n("code",[t._v("diamondCut")]),t._v(" function and/or possibly other functions to add/replace/remove functions. It is useful for iterative development or improving an application over time.")]),t._v(" "),n("p",[n("strong",[t._v("Finished Diamond")]),t._v("\nA finished diamond was an upgradeable diamond and had a number of upgrades. Then its "),n("code",[t._v("diamondCut")]),t._v(" function and/or other upgrade functions were removed and upgrades are no longer possible. It is no longer possible to add/replace/remove functions. It has become an immutable diamond.")]),t._v(" "),n("p",[n("strong",[t._v("Single Cut Diamond")]),t._v("\nA single cut diamond adds all functions to itself in its constructor function, but it does not add the "),n("code",[t._v("diamondCut")]),t._v(" function or any other function that can add/replace/remove functions. This means that a single cut diamond is fully created in its constructor and once created can never be upgraded. It has the same immutability and trustless guarantees as a regular vanilla contract. Why would someone do this? There may be a number of reasons. The two use cases below are good reasons.")]),t._v(" "),n("ol",[n("li",[t._v("Your contract hits the max contract size limit. Make it into a single cut diamond. You still break your big contract into smaller facets, modularizing your code.")]),t._v(" "),n("li",[t._v("You start with an upgradeable diamond in your development and testing and upgrade it to your heart's delight. Reap the advantages of easy upgrading and a stable address as you work out new features, bugs and kinks. Release the upgradeable diamond on a test network with your application for beta testing and upgrade it when needed. This is iterative development. When it is solid then deploy it as a single cut diamond on the main network.")])]),t._v(" "),n("h2",{attrs:{id:"specification"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[t._v("#")]),t._v(" Specification")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note:")]),t._v("\nThe solidity "),n("code",[t._v("delegatecall")]),t._v(" opcode enables a contract to execute a function from another contract, but it is executed as if the function was from the calling contract. Essentially "),n("code",[t._v("delegatecall")]),t._v(' enables a contract to "borrow" another contract\'s function. Functions executed with '),n("code",[t._v("delegatecall")]),t._v(" affect the contract storage of the calling contract, not the contract where the functions are defined.")])]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note:")]),t._v(" This specification specifies what needs to be implemented for a contract to be a diamond.")])]),t._v(" "),n("h3",{attrs:{id:"terms"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#terms"}},[t._v("#")]),t._v(" Terms")]),t._v(" "),n("ol",[n("li",[t._v("A "),n("strong",[t._v("diamond")]),t._v(" is a contract that uses functions from its facets to execute function calls. A diamond can have one or more facets.")]),t._v(" "),n("li",[t._v("The word "),n("strong",[t._v("facet")]),t._v(" comes from the diamond industry. It is a side, or flat surface of a diamond. A diamond can have many facets. In this standard a facet is a contract with one or more functions that executes functionality of a diamond.")]),t._v(" "),n("li",[t._v("A "),n("strong",[t._v("loupe")]),t._v(" is a magnifying glass that is used to look at diamonds. In this standard a loupe is a facet that provides functions to look at a diamond and its facets.")]),t._v(" "),n("li",[t._v("An "),n("strong",[t._v("immutable function")]),t._v(" is a function that is defined directly in a diamond and so cannot be replaced or removed. Or it is a function that is defined in a facet that cannot be replaced or removed because all upgrade functions have been removed from a diamond.")])]),t._v(" "),n("h3",{attrs:{id:"general-summary"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#general-summary"}},[t._v("#")]),t._v(" General Summary")]),t._v(" "),n("p",[t._v("A diamond calls functions from its facets using "),n("code",[t._v("delegatecall")]),t._v(".")]),t._v(" "),n("p",[t._v("In the diamond industry diamonds are created and shaped by being cut, creating facets. In this standard diamonds are cut by adding, replacing or removing facets and their functions.")]),t._v(" "),n("h4",{attrs:{id:"the-diamondcut-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#the-diamondcut-function"}},[t._v("#")]),t._v(" The diamondCut Function")]),t._v(" "),n("p",[t._v("The standard "),n("code",[t._v("diamondCut")]),t._v(" function specified below can be used to add/replace/remove any number of functions from/to a diamond in a single transaction.")]),t._v(" "),n("p",[t._v("The standard "),n("code",[t._v("diamondCut")]),t._v(" function below is specified for the purpose of interoperability. Diamond tools, software and user-interfaces should expect and use the standard "),n("code",[t._v("diamondCut")]),t._v(" function. Diamonds that might work with diamond specific tooling to add/replace/remove functions should implement the standard "),n("code",[t._v("diamondCut")]),t._v(" function.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("diamondCut")]),t._v(" function is optional. It does not have to be implemented in a diamond. For example an immutable diamond wouldn't have this function.")]),t._v(" "),n("p",[t._v("You can implement your own custom functions that add or replace or remove functions. You can also implement your own non-standard versions of "),n("code",[t._v("diamondCut")]),t._v(" that have different parameters.")]),t._v(" "),n("p",[t._v("If you want to create your own custom function(s) for adding/replacing/removing functions you might also want to implement the standard "),n("code",[t._v("diamondCut")]),t._v(" function for interoperability with tools.")]),t._v(" "),n("p",[n("strong",[t._v("In ALL cases any function or code that adds or replaces or removes one or more functions MUST emit the standard DiamondCut event specified below.")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("DiamondCut")]),t._v(" event records all changes to a diamond.")]),t._v(" "),n("h3",{attrs:{id:"diamond-interface"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-interface"}},[t._v("#")]),t._v(" Diamond Interface")]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IDiamondCut")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FacetCutAction")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Remove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Add=0, Replace=1, Remove=2")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FacetCut")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" facetAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        FacetCutAction action"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" functionSelectors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice Add/replace/remove any number of functions and optionally execute")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///         a function with delegatecall")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _diamondCut Contains the facet addresses and function selectors")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _init The address of the contract or facet to execute _calldata")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _calldata A function call, including function selector and arguments")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///                  _calldata is executed with delegatecall on _init")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diamondCut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        FacetCut"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _diamondCut"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _calldata\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DiamondCut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FacetCut"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" _diamondCut"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" _calldata"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("h4",{attrs:{id:"adding-replacing-removing-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#adding-replacing-removing-functions"}},[t._v("#")]),t._v(" Adding/Replacing/Removing Functions")]),t._v(" "),n("p",[t._v("A diamond contains within it a mapping of function selectors to facet addresses. Functions are added/replaced/removed by modifying this mapping.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("_diamondCut")]),t._v(" argument is an array of FacetCut structs.")]),t._v(" "),n("p",[t._v("Each FacetCut struct contains a facet address and array of function selectors that are updated in a diamond.")]),t._v(" "),n("p",[t._v("To add new functions create a FacetCut struct with "),n("code",[t._v("facetAddress")]),t._v(" set to the facet that has the new functions and "),n("code",[t._v("functionSelectors")]),t._v(" set with the function selectors to add. Set the "),n("code",[t._v("action")]),t._v(" enum to "),n("code",[t._v("Add")]),t._v(".")]),t._v(" "),n("p",[t._v("To replace functions create a FacetCut struct with "),n("code",[t._v("facetAddress")]),t._v(" set to the facet that has the replacement functions and "),n("code",[t._v("functionSelectors")]),t._v(" set with the function selectors to replace. Set the "),n("code",[t._v("action")]),t._v(" enum to "),n("code",[t._v("Replace")]),t._v(".")]),t._v(" "),n("p",[t._v("To remove functions create a FacetCut struct with "),n("code",[t._v("facetAddress")]),t._v(" set to "),n("code",[t._v("address(0)")]),t._v(" and "),n("code",[t._v("functionSelectors")]),t._v(" set with the function selectors to remove. Set the "),n("code",[t._v("action")]),t._v(" enum to "),n("code",[t._v("Remove")]),t._v(".")]),t._v(" "),n("p",[t._v("It is the design of the "),n("code",[t._v("diamondCut")]),t._v(" function that cuts are explicit and intentional.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("diamondCut")]),t._v(" function reverts when attempting to add a function that already exists.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("diamondCut")]),t._v(" function reverts when attempting to replace a function with a facet it is already using.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("diamondCut")]),t._v(" function reverts when attempting to remove a function that already does not exist.")]),t._v(" "),n("h4",{attrs:{id:"executing-calldata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#executing-calldata"}},[t._v("#")]),t._v(" Executing _calldata")]),t._v(" "),n("p",[t._v("After adding/replacing/removing functions the "),n("code",[t._v("_calldata")]),t._v(" argument is executed with "),n("code",[t._v("delegatecall")]),t._v(" on "),n("code",[t._v("_init")]),t._v(". This execution is done to initialize data or setup or remove anything needed or no longer needed after adding, replacing and/or removing functions.")]),t._v(" "),n("p",[t._v("If the "),n("code",[t._v("_init")]),t._v(" value is "),n("code",[t._v("address(0)")]),t._v(" then "),n("code",[t._v("_calldata")]),t._v(" execution is skipped. In this case "),n("code",[t._v("_calldata")]),t._v(" can contain 0 bytes or custom information.")]),t._v(" "),n("p",[t._v("If the "),n("code",[t._v("_init")]),t._v(" value is not "),n("code",[t._v("address(0)")]),t._v(" then "),n("code",[t._v("_calldata")]),t._v(" must contain more than 0 bytes or the transaction reverts.")]),t._v(" "),n("h4",{attrs:{id:"diamondcut-event"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamondcut-event"}},[t._v("#")]),t._v(" DiamondCut Event")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("_diamondCut")]),t._v(", "),n("code",[t._v("_init")]),t._v(", and "),n("code",[t._v("_calldata")]),t._v(" arguments are passed directly to the "),n("code",[t._v("DiamondCut")]),t._v(" event.")]),t._v(" "),n("p",[t._v("Any time one or more functions are added, replaced or removed the "),n("code",[t._v("DiamondCut")]),t._v(" event MUST be emitted to record changes.")]),t._v(" "),n("h3",{attrs:{id:"diamond-loupe"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-loupe"}},[t._v("#")]),t._v(" Diamond Loupe")]),t._v(" "),n("blockquote",[n("p",[t._v("A loupe is a small magnifying glass used to look at diamonds.\nThese functions look at diamonds.")])]),t._v(" "),n("p",[t._v("The function selectors used by a diamond are queried to get what functions the diamond has and what facets are used.")]),t._v(" "),n("p",[t._v("A diamond loupe is a facet that implements this interface:")]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A loupe is a small magnifying glass used to look at diamonds.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// These functions look at diamonds")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IDiamondLoupe")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// These functions are expected to be called frequently")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// by tools.")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Facet")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" facetAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" functionSelectors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice Gets all facet addresses and their four byte function selectors.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @return facets_ Facet")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("facets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Facet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" facets_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice Gets all the function selectors supported by a specific facet.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _facet The facet address.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @return facetFunctionSelectors_")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("facetFunctionSelectors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _facet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" facetFunctionSelectors_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice Get all the facet addresses used by a diamond.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @return facetAddresses_")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("facetAddresses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" facetAddresses_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice Gets the facet that supports the given selector.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @dev If facet is not found return address(0).")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _functionSelector The function selector.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @return facetAddress_ The facet address.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("facetAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),t._v(" _functionSelector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" facetAddress_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br")])]),n("p",[t._v("See a "),n("a",{attrs:{href:"https://github.com/mudgen/Diamond",target:"_blank",rel:"noopener noreferrer"}},[t._v("reference implementation"),n("OutboundLink")],1),t._v(" to see how this can be implemented.")]),t._v(" "),n("p",[t._v("The loupe functions can be used in user-interface software. A user interface calls these functions to provide information about and visualize diamonds.")]),t._v(" "),n("p",[t._v("The loupe functions can be used in deployment functionality, upgrade functionality, testing and other software.")]),t._v(" "),n("p",[t._v("Some loupe implementations are not gas efficient and should not be called in on-chain transactions. Some loupe implementations may be gas efficient and can be called in on-chain transactions. Read the documentation of the loupe implementation you use.")]),t._v(" "),n("h3",{attrs:{id:"implementation-points"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#implementation-points"}},[t._v("#")]),t._v(" Implementation Points")]),t._v(" "),n("p",[t._v("A diamond implements the following implementation points:")]),t._v(" "),n("ol",[n("li",[t._v("A diamond contains a fallback function and zero or more immutable functions that are defined within it.")]),t._v(" "),n("li",[t._v("A diamond associates function selectors with facets.")]),t._v(" "),n("li",[t._v('When a function is called on a diamond it executes immediately if it is an "immutable function" defined directly in the diamond. Otherwise the diamond\'s fallback function is executed. The fallback function finds the facet associated with the function and executes the function using '),n("code",[t._v("delegatecall")]),t._v(". If there is no facet for the function then optionally a default function may be executed. If there is no facet for the function and no default function and no other mechanism to handle it then execution reverts.")]),t._v(" "),n("li",[t._v("Each time functions are added, replaced or removed a "),n("code",[t._v("DiamondCut")]),t._v(" event is emitted to record it.")]),t._v(" "),n("li",[t._v("A diamond implements the DiamondLoupe interface.")]),t._v(" "),n("li",[t._v("All immutable functions must be emitted in the "),n("code",[t._v("DiamondCut")]),t._v(" event as new functions added. And the loupe functions must return information about immutable functions if they exist. The facet address for an immutable function is the diamond's address.")]),t._v(" "),n("li",[t._v("Optionally a diamond implements ERC165. If a diamond has the "),n("code",[t._v("diamondCut")]),t._v(" function then the interface ID used for it is "),n("code",[t._v("IDiamondCut.diamondCut.selector")]),t._v(". The interface ID used for the diamond loupe interface is "),n("code",[t._v("IDiamondLoupe.facets.selector ^ IDiamondLoupe.facetFunctionSelectors.selector ^ IDiamondLoupe.facetAddresses.selector ^ IDiamondLoupe.facetAddress.selector")]),t._v(".")])]),t._v(" "),n("p",[t._v("The diamond address is the address that users interact with. The diamond address does not change. Only facet addresses can change by using the "),n("code",[t._v("diamondCut")]),t._v(" function, or other function.")]),t._v(" "),n("h2",{attrs:{id:"implementation"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[t._v("#")]),t._v(" Implementation")]),t._v(" "),n("p",[t._v("Reference diamond implementations exist in the "),n("a",{attrs:{href:"https://github.com/mudgen/Diamond",target:"_blank",rel:"noopener noreferrer"}},[t._v("Diamond repository"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"rationale"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[t._v("#")]),t._v(" Rationale")]),t._v(" "),n("h3",{attrs:{id:"using-function-selectors"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#using-function-selectors"}},[t._v("#")]),t._v(" Using Function Selectors")]),t._v(" "),n("p",[t._v("User interface software can be used to retrieve function selectors and face addresses from a diamond in order show what functions a diamond has.")]),t._v(" "),n("p",[t._v("This standard is designed to make diamonds work well with user-interface software. Function selectors with the ABI of a contract provide enough information about functions to be useful for user-interface software.")]),t._v(" "),n("h3",{attrs:{id:"gas-considerations"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gas-considerations"}},[t._v("#")]),t._v(" Gas Considerations")]),t._v(" "),n("p",[t._v("Delegating function calls does have some gas overhead. This is mitigated in several ways:")]),t._v(" "),n("ol",[n("li",[t._v("Because diamonds do not have a max size limitation it is possible to add gas optimizing functions for use cases. For example someone could use a diamond to implement the ERC721 standard and implement batch transfer functions from the "),n("a",{attrs:{href:"https://github.com/ethereum/EIPs/issues/1412",target:"_blank",rel:"noopener noreferrer"}},[t._v("ERC1412 standard"),n("OutboundLink")],1),t._v(" to reduce gas (and make batch transfers more convenient).")]),t._v(" "),n("li",[t._v("Some contract architectures require calling many contracts in one transaction. Gas savings can be realized by condensing those contracts into a single diamond and accessing contract storage directly.")]),t._v(" "),n("li",[t._v("Facets can be small, reducing gas costs. Because it costs more gas to call a function in a contract with many functions than a contract with few functions.")]),t._v(" "),n("li",[t._v("The Solidity optimizer can be set to a high setting causing more bytecode to be generated but the facets will use less gas when executed.")])]),t._v(" "),n("h3",{attrs:{id:"diamond-storage-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-storage-2"}},[t._v("#")]),t._v(" Diamond Storage")]),t._v(" "),n("p",[t._v("Since Solidity 0.6.4 it is possible to create pointers to structs in arbitrary places in contract storage. This enables diamonds and their facets to create their own storage layouts that are separate from each other and do not conflict with each other, but can still be shared between them. See this blog post for more information: "),n("a",{attrs:{href:"https://medium.com/1milliondevs/new-storage-layout-for-proxy-contracts-and-diamonds-98d01d0eadb",target:"_blank",rel:"noopener noreferrer"}},[t._v("New Storage Layout For Proxy Contracts and Diamonds"),n("OutboundLink")],1),t._v(". The reference implementations for EIP-2535 uses Diamond Storage.")]),t._v(" "),n("p",[t._v("Diamond Storage is not the same thing as unstructured storage. Unstructured storage reads and writes specific values like unsigned integers and addresses at specified locations in contract storage. Diamond Storage uses structs at specified locations in contract storage for reading and writing. Structs can hold any number of state variables of any type.")]),t._v(" "),n("h3",{attrs:{id:"versions-of-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#versions-of-functions"}},[t._v("#")]),t._v(" Versions of Functions")]),t._v(" "),n("p",[t._v("Software or a user can verify what version of a function is called by getting the facet address of the function. This can be done by calling the "),n("code",[t._v("facetAddress")]),t._v(" function from the DiamondLoupe interface. This function takes a function selector as an argument and returns the facet address where it is implemented.")]),t._v(" "),n("h3",{attrs:{id:"sharing-functions-between-facets"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sharing-functions-between-facets"}},[t._v("#")]),t._v(" Sharing Functions Between Facets")]),t._v(" "),n("p",[t._v("In some cases it might be necessary to call a function defined in a different facet.\nHere are some solutions to this:")]),t._v(" "),n("ol",[n("li",[t._v("Copy internal function code in one facet to the other facet.")]),t._v(" "),n("li",[t._v("Put common internal functions in a contract that is inherited by multiple facets.")]),t._v(" "),n("li",[t._v("Put common internal functions in a Solidity library and use the library in facets.")]),t._v(" "),n("li",[t._v("A type safe way to call an external function defined in another facet is to do this: MyOtherFacet(address(this)).myFunction(arg1, arg2)")]),t._v(" "),n("li",[t._v("A more gas-efficient way to call an external function defined in another facet is to use "),n("code",[t._v("delegatecall")]),t._v(". Here is an example of doing that:")])]),t._v(" "),n("div",{staticClass:"language-Solidity line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("DiamondStorage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("storage")]),t._v(" ds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diamondStorage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),t._v(" functionSelector "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keccak256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myFunction(uint256)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get facet address of function")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" facet "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selectorToFacet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("functionSelector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" myFunctionCall "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" abi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeWithSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("functionSelector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("facet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delegatecall")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myFunctionCall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myFunction failed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("ol",{attrs:{start:"6"}},[n("li",[t._v("Instead of calling an external function defined in another facet you can instead create an internal function version of the external function. Add the internal version of the function to the facet that needs to use it.")])]),t._v(" "),n("h3",{attrs:{id:"default-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#default-function"}},[t._v("#")]),t._v(" Default Function")]),t._v(" "),n("p",[t._v("Solidity provides the "),n("code",[t._v("fallback")]),t._v(" function so that specific functionality can be executed when a function is called on a contract that does not exist in the contract. This same behavior can optionally be implemented in a diamond by implementing and using a default function, which is a function that is executed when a function is called on a diamond that does not exist in the diamond.")]),t._v(" "),n("p",[t._v("A default function can be implemented a number of ways and this standard does not specify how it must be implemented.")]),t._v(" "),n("h2",{attrs:{id:"security-considerations"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations"}},[t._v("#")]),t._v(" Security Considerations")]),t._v(" "),n("h3",{attrs:{id:"ownership-and-authentication"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ownership-and-authentication"}},[t._v("#")]),t._v(" Ownership and Authentication")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("Note:")]),t._v(" The design and implementation of diamond ownership/authentication is "),n("strong",[t._v("not")]),t._v(" part of this standard. The examples given in this standard and in the reference implementation are just "),n("strong",[t._v("examples")]),t._v(" of how it could be done.")])]),t._v(" "),n("p",[t._v("It is possible to create many different authentication or ownership schemes with EIP-2535. Authentication schemes can be very simple or complex, fine grained or coarse. EIP-2535 does not limit it in any way. For example ownership/authentication could be as simple as a single account address having the authority to add/replace/remove functions. Or a decentralized autonomous organization could have the authority to only add/replace/remove certain functions.")]),t._v(" "),n("p",[t._v("Consensus functionality could be implemented such as an approval function that multiple different people call to approve changes before they are executed with the "),n("code",[t._v("diamondCut")]),t._v(" function. These are just examples.")]),t._v(" "),n("p",[t._v("The development of standards and implementations of ownership, control and authentication of diamonds is encouraged.")]),t._v(" "),n("h3",{attrs:{id:"security-of-diamond-storage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#security-of-diamond-storage"}},[t._v("#")]),t._v(" Security of Diamond Storage")]),t._v(" "),n("p",[t._v("If a person can add/replace functions then that person can alter storage willy-nilly. This is very powerful and very dangerous. However the capability can be used while eliminating or reducing the danger. The danger is eliminated or reduced by limiting "),n("strong",[t._v("who")]),t._v(" can add/replace/remove functions, limiting "),n("strong",[t._v("when")]),t._v(" functions can be added/replaced/removed and by "),n("strong",[t._v("transparency")]),t._v(".")]),t._v(" "),n("p",[n("strong",[t._v("Who")]),t._v("\nHere are some ways "),n("strong",[t._v("who")]),t._v(" can be limited:")]),t._v(" "),n("ol",[n("li",[t._v("Only allow a trusted individual or organization to make diamond upgrades.")]),t._v(" "),n("li",[t._v("Only allow a distributed autonomous organization to make diamond upgrades.")]),t._v(" "),n("li",[t._v("Only allow multi-signature upgrades.")]),t._v(" "),n("li",[t._v("Only allow the end user who owns his own diamond to make upgrades. This enables users to opt-in to upgrades.")]),t._v(" "),n("li",[t._v("Don't allow anybody to make upgrades by making a single cut diamond.")])]),t._v(" "),n("p",[n("strong",[t._v("When")]),t._v("\nHere are some ways "),n("strong",[t._v("when")]),t._v(" can be limited:")]),t._v(" "),n("ol",[n("li",[t._v("Only allow upgrades during development and testing. Make a single cut diamond for main network release.")]),t._v(" "),n("li",[t._v("Use an upgradeable diamond until it is certain that no new features are needed and then make it a finished diamond by removing the ability to add/replace/remove functions.")]),t._v(" "),n("li",[t._v("Program into the "),n("code",[t._v("diamondCut")]),t._v(" function certain periods of time that the diamond can be upgraded. For example the "),n("code",[t._v("diamondCut")]),t._v(" function could be programmed so that a diamond could only be upgraded during a specific five hour period each year. Attention and transparency could be applied to that five hour period to ensure upgrades are done right.")])]),t._v(" "),n("p",[n("strong",[t._v("Transparency")]),t._v("\nTransparency provides certainty and proof that upgrades are done correctly and honestly.")]),t._v(" "),n("ol",[n("li",[t._v("Publish and make available verified source code used by diamonds and facets.")]),t._v(" "),n("li",[t._v("Provide documentation for diamonds, facets, upgrade plans, and results of upgrades.")]),t._v(" "),n("li",[t._v("Provide tools and/or user interfaces that make your diamonds more visible and understandable.")])]),t._v(" "),n("h3",{attrs:{id:"function-selector-clash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#function-selector-clash"}},[t._v("#")]),t._v(" Function Selector Clash")]),t._v(" "),n("p",[t._v("A function selector clash occurs when two different function signatures hash to the same four-byte hash. This has the unintended consequence of replacing an existing function in a diamond when the intention was to add a new function. This scenario is not possible with the "),n("code",[t._v("diamondCut")]),t._v(" function because it prevents adding function selectors that already exist.")]),t._v(" "),n("h3",{attrs:{id:"transparency"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#transparency"}},[t._v("#")]),t._v(" Transparency")]),t._v(" "),n("p",[t._v("Diamonds emit an event every time one or more functions are added, replaced or removed. All source code can be verified. This enables people and software to monitor changes to a contract. If any bad acting function is added to a diamond then it can be seen.")]),t._v(" "),n("p",[t._v("Security and domain experts can review the history of change of a diamond to detect any history of foul play.")]),t._v(" "),n("h2",{attrs:{id:"backwards-compatibility"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[t._v("#")]),t._v(" Backwards Compatibility")]),t._v(" "),n("p",[t._v("This standard makes upgradeable diamonds compatible with future standards and functionality because new functions can be added and existing functions can be replaced or removed.")]),t._v(" "),n("h2",{attrs:{id:"learning-references"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#learning-references"}},[t._v("#")]),t._v(" Learning & References")]),t._v(" "),n("h3",{attrs:{id:"diamond-articles"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-articles"}},[t._v("#")]),t._v(" Diamond Articles")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://eip2535diamonds.substack.com/p/introduction-to-the-diamond-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("Introduction to the Diamond Standard, EIP-2535 Diamonds"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://eip2535diamonds.substack.com/p/smart-contract-security-audits-for",target:"_blank",rel:"noopener noreferrer"}},[t._v("Smart Contract Security Audits for EIP-2535 Diamonds Implementations"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/why-diamonds-need-a-standard-1i1h",target:"_blank",rel:"noopener noreferrer"}},[t._v("Why Ethereum Diamonds Need A Standard"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/ethereum-s-maximum-contract-size-limit-is-solved-with-the-diamond-standard-2189",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ethereum's Maximum Contract Size Limit is Solved with EIP-2535 Diamonds"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/understanding-diamonds-on-ethereum-1fb",target:"_blank",rel:"noopener noreferrer"}},[t._v("Understanding Diamonds"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/why-diamonds-need-a-standard-1i1h",target:"_blank",rel:"noopener noreferrer"}},[t._v("Why Ethereum Diamonds Need A Standard"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/why-loupe-functions-for-diamonds-1kc3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Diamond Loupe Functions?"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/derivadex/the-diamond-standard-a-new-paradigm-for-upgradeability-569121a08954",target:"_blank",rel:"noopener noreferrer"}},[t._v("EIP-2535 Diamonds: A new paradigm for upgradeability"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://hiddentao.com/archives/2020/05/28/upgradeable-smart-contracts-using-diamond-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("Upgradeable smart contracts using EIP-2535 Diamonds"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/ethereum-diamonds-for-on-chain-decentralized-governance-39op",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ethereum Diamonds for On-Chain Decentralized Governance"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/how-to-share-functions-between-facets-of-a-diamond-1njb",target:"_blank",rel:"noopener noreferrer"}},[t._v("How to Share Functions Between Facets of a Diamond"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"diamond-storage-articles"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-storage-articles"}},[t._v("#")]),t._v(" Diamond Storage Articles")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/how-diamond-storage-works-90e",target:"_blank",rel:"noopener noreferrer"}},[t._v("How Diamond Storage Works"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/appstorage-pattern-for-state-variables-in-solidity-3lki",target:"_blank",rel:"noopener noreferrer"}},[t._v("AppStorage Pattern for State Variables in Solidity"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/1milliondevs/new-storage-layout-for-proxy-contracts-and-diamonds-98d01d0eadb",target:"_blank",rel:"noopener noreferrer"}},[t._v("New Storage Layout For Proxy Contracts and Diamonds"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://dev.to/mudgen/solidity-libraries-can-t-have-state-variables-oh-yes-they-can-3ke9",target:"_blank",rel:"noopener noreferrer"}},[t._v("Solidity Libraries Can't Have State Variables -- Oh Yes They Can!"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/coinmonks/smart-contracts-sharing-common-data-777310263ac0?source=friends_link&sk=b462ff3559ae9c8da243ba31a557e4f4",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Smart Contracts Sharing Common Data"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/coinmonks/sharing-common-data-using-libraries-6573857d328c?source=friends_link&sk=1da1ef153b8d15f3f7bb9f4ce429890a",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sharing Common Data Using Libraries"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"diamond-tools"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diamond-tools"}},[t._v("#")]),t._v(" Diamond Tools")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://louper.dev/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Louper"),n("OutboundLink")],1),t._v(" A user interface for all diamonds.")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/wighawag/buidler-deploy#diamonds-and-facets",target:"_blank",rel:"noopener noreferrer"}},[t._v("buidler-deploy"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"implementations"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#implementations"}},[t._v("#")]),t._v(" Implementations")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mudgen/Diamond",target:"_blank",rel:"noopener noreferrer"}},[t._v("Diamond reference implementations"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/aavegotchi/ghst-staking",target:"_blank",rel:"noopener noreferrer"}},[t._v("GHST Staking"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/pie-dao/ExperiPie",target:"_blank",rel:"noopener noreferrer"}},[t._v("pie-dao / ExperiPie"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/nayms/contracts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nayms Contracts"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/aavegotchi/aavegotchi-contracts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Aavegotchi Diamond"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"help"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#help"}},[t._v("#")]),t._v(" Help")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://discord.gg/kQewPw2",target:"_blank",rel:"noopener noreferrer"}},[t._v("EIP-2535 Diamonds Discord"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"inspiration-development"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inspiration-development"}},[t._v("#")]),t._v(" Inspiration & Development")]),t._v(" "),n("p",[t._v("EIP-2535 is an improved design over "),n("RouterLink",{attrs:{to:"/eip-1538.html"}},[t._v("EIP-1538")]),t._v(" using ABIEncoderV2 and function selectors.")],1),t._v(" "),n("p",[t._v("EIP-2535 replaces EIP-1538.")]),t._v(" "),n("p",[t._v("This standard was inspired by "),n("RouterLink",{attrs:{to:"/eip-1538.html"}},[t._v("EIP-1538")]),t._v(" and ZeppelinOS's implementation of "),n("a",{attrs:{href:"https://github.com/zeppelinos/labs/tree/master/upgradeability_with_vtable",target:"_blank",rel:"noopener noreferrer"}},[t._v("Upgradeability with vtables"),n("OutboundLink")],1),t._v(".")],1),t._v(" "),n("p",[t._v("This standard was also inspired by the design and implementation of the "),n("a",{attrs:{href:"https://etherscan.io/address/0xc1eab49cf9d2e23e43bcf23b36b2be14fc2f8838#code",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mokens contract"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"copyright"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[t._v("#")]),t._v(" Copyright")]),t._v(" "),n("p",[t._v("Copyright and related rights waived via "),n("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CC0"),n("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);a.default=s.exports}}]);