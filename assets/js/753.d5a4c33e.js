(window.webpackJsonp=window.webpackJsonp||[]).push([[753],{1178:function(e,t,a){"use strict";a.r(t);var s=a(46),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v("Introduce the "),a("code",[e._v("PUSH0")]),e._v(" ("),a("code",[e._v("0x5f")]),e._v(") instruction, which pushes the constant value 0 onto the stack.")]),e._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("p",[e._v("Many instructions expect offsets as inputs, which in a number of cases are zero. A good example is the return data parameters of "),a("code",[e._v("CALLs")]),e._v(", which are set to zeroes in case the contract prefers using "),a("code",[e._v("RETURNDATA*")]),e._v(". This is only one example, but there are many other reasons why a contract would need to push a zero value. They can achieve that today by "),a("code",[e._v("PUSH1 0")]),e._v(", which costs 3 gas at runtime, and is encoded as two bytes which means "),a("code",[e._v("2 * 200")]),e._v(" gas deployment cost.")]),e._v(" "),a("p",[e._v("Because of the overall cost many try to use various other instructions to achieve the same effect. Common examples include "),a("code",[e._v("PC")]),e._v(", "),a("code",[e._v("MSIZE")]),e._v(", "),a("code",[e._v("CALLDATASIZE")]),e._v(", "),a("code",[e._v("RETURNDATASIZE")]),e._v(", "),a("code",[e._v("CODESIZE")]),e._v(", "),a("code",[e._v("CALLVALUE")]),e._v(", and "),a("code",[e._v("SELFBALANCE")]),e._v(". Some of these cost only 2 gas and are a single byte long, but their value can depend on the context.")]),e._v(" "),a("p",[e._v("We have conducted an analysis on Mainnet (block ranges 8,567,259…8,582,058 and 12,205,970…12,817,405), and ~11.5% of all the "),a("code",[e._v("PUSH*")]),e._v(" instructions executed push a value of zero.")]),e._v(" "),a("p",[e._v("The main motivations for this change include:")]),e._v(" "),a("ol",[a("li",[e._v("Reducing contract code size.")]),e._v(" "),a("li",[e._v("Reducing the risk of contracts (mis)using various instructions as an optimisation measure. Repricing/changing those instructions can be more risky.")]),e._v(" "),a("li",[e._v("Reduce the need to use "),a("code",[e._v("DUP")]),e._v(" instructions for duplicating zeroes.")])]),e._v(" "),a("p",[e._v('To put the "waste" into perspective, across existing accounts 340,557,331 bytes are wasted on '),a("code",[e._v("PUSH1 00")]),e._v(" instructions, which means 68,111,466,200 gas was spent to deploy them. In practice a lot of these accounts share identical bytecode with others, so their total stored size in clients is lower, however the deploy time cost must have been paid nevertheless.")]),e._v(" "),a("p",[e._v("An example for 2) is changing the behaviour of "),a("code",[e._v("RETURNDATASIZE")]),e._v(" such that it may not be guaranteed to be zero at the beginning of the call frame. This was proposed as a way to chain transactions (i.e. EIP-2733).")]),e._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("p",[e._v("Starting "),a("code",[e._v("BLOCK_NUMBER >= HF")]),e._v(", the instruction "),a("code",[e._v("PUSH0")]),e._v(" is introduced at "),a("code",[e._v("0x5f")]),e._v(". It has no immediate data, pops no items from the stack, and places a single item with the value 0 onto the stack. The cost of this instruction is 2 gas (aka "),a("code",[e._v("verylow")]),e._v(").")]),e._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),a("h3",{attrs:{id:"gas-cost"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gas-cost"}},[e._v("#")]),e._v(" Gas cost")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("verylow")]),e._v(" gas cost is used for instructions which place constant values onto the stack, such as "),a("code",[e._v("ADDRESS")]),e._v(", "),a("code",[e._v("ORIGIN")]),e._v(", and so forth.")]),e._v(" "),a("h3",{attrs:{id:"opcode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opcode"}},[e._v("#")]),e._v(" Opcode")]),e._v(" "),a("p",[a("code",[e._v("0x5f")]),e._v(' means it is in a "contiguous" space with the rest of the '),a("code",[e._v("PUSH")]),e._v(" implementations and potentially could share the implementation.")]),e._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards Compatibility")]),e._v(" "),a("p",[e._v("This EIP introduces a new opcode which did not exists previously. Already deployed contracts using this opcode could change their behaviour after this EIP.")]),e._v(" "),a("h2",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[e._v("#")]),e._v(" Test Cases")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("5F")]),e._v(" -- successful execution, stack consist of a single item, set to zero")]),e._v(" "),a("li",[a("code",[e._v("5F5F..5F")]),e._v(" (1024 times) -- successful execution, stack consists of 1024 items, all set to zero")]),e._v(" "),a("li",[a("code",[e._v("5F5F..5F")]),e._v(" (1025 times) -- execution aborts due to out of stack")])]),e._v(" "),a("h2",{attrs:{id:"security-considerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations"}},[e._v("#")]),e._v(" Security Considerations")]),e._v(" "),a("p",[e._v("The authors are not aware of any impact on security. Note that jumpdest-analysis is unaffected, as "),a("code",[e._v("PUSH0")]),e._v(" has no immediate data bytes.")]),e._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CC0"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=o.exports}}]);