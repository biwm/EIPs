(window.webpackJsonp=window.webpackJsonp||[]).push([[740],{1165:function(e,t,a){"use strict";a.r(t);var s=a(46),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple Summary")]),e._v(" "),a("p",[e._v("Do not allow transactions for which "),a("code",[e._v("tx.sender")]),e._v(" has any code deployed, i.e. "),a("code",[e._v("tx.sender")]),e._v(" has a "),a("code",[e._v("CODEHASH != EMPTYCODEHASH")])]),e._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v("Ethereum addresses are currently only 160 bits long. This means it is possible to create a collision between a contract account and an Externally Owned Account (EOA) using an estimated "),a("code",[e._v("2**80")]),e._v(" computing operations, which is feasible now given a large budget (ca. 10 billion USD). The fix in this EIP prevents the worst possible attack, where a safe looking contract (e.g. a token wrapper or an AMM-type contract) is deployed to attract user funds, which can then be spent using the EOA key for the same address. The fix is to never allow to use an address that already has code deployed as an EOA address.")]),e._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("h3",{attrs:{id:"generating-address-collisions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generating-address-collisions"}},[e._v("#")]),e._v(" Generating address collisions")]),e._v(" "),a("p",[e._v("By creating keys for "),a("code",[e._v("2**80")]),e._v(" EOAs and simulating the deployment of "),a("code",[e._v("2**80")]),e._v(" contracts from these EOAs (one each), one expects to find about one collision where an EOA has the same address as one contract.")]),e._v(" "),a("p",[e._v("This very simple form of the attack requires the storage of "),a("code",[e._v("2**80")]),e._v(" addresses, which is a practical barrier: It would require "),a("code",[e._v("2.4*10**25")]),e._v(" bytes of memory (24 Yottabyte). However, there are cycle finding algorithms that can perform the collision search without requiring large amounts of storage. An estimate for the complexity has been made "),a("a",{attrs:{href:"https://hackmd.io/Vzhp5YJyTT-LhWm_s0JQpA",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(". We estimate that a collision between a contract and an EOA could be found in about one year with an investment of ca. US$10 billion in hardware and electricity.")]),e._v(" "),a("h3",{attrs:{id:"background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),a("p",[e._v("There is currently a discussion to move to 256-bit addresses on Ethereum, which would increase collision resistance to a complexity of "),a("code",[e._v("2**128")]),e._v(" which is currently thought infeasible for the foreseeable future. However, with 160 bit addresses, the collision problem can be effectively solved now, as demonstrated above.")]),e._v(" "),a("p",[e._v("Most attacks that can occur via address collisions are quite impractical: They involve users sending funds to an address before a contract is deployed. This is a very rare application in practice and users can easily circumvent the attack by never sending funds to a contract until it has been safely deployed with enough confirmations.")]),e._v(" "),a("p",[e._v("However, the yellow paper does not explicitly specify how a client should handle the case where a transaction is sent from an account that already has contract code deployed; presumably because this was considered infeasible at the time. The assumption is that most client would allow this transaction in their current state.")]),e._v(" "),a("p",[e._v("This EIP is to specify this behaviour to always forbid such transactions. This fixes most realistic or serious attacks due to address collisions.")]),e._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("p",[e._v("Any transaction where "),a("code",[e._v("tx.sender")]),e._v(" has a "),a("code",[e._v("CODEHASH != EMPTYCODEHASH")]),e._v(" MUST be rejected as invalid. With "),a("code",[e._v("EMPTYCODEHASH = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),a("p",[e._v("We note that it was always the expected that a contract account's behaviour is constrainted by the code in that contract -- which means that the account's funds should not suddenly be spendable by some private key. It was just implicitly assumed in the past that a 160 bit address length is enough to provide collision resistance, and thus that this case could never occur. In that sense, this EIP should be seen as a clarification of protocol behaviour in a previously undefined case rather than an explicit upgrade of consensus rules.")]),e._v(" "),a("p",[e._v("This does not exclude all possible attack vectors, only the most serious one. Further possible attack vectors via address collisions between contracts and EOAs are:")]),e._v(" "),a("ol",[a("li",[e._v("An attacker can convince a user to send funds to an account before it is deployed. Some applications require this behaviour (e.g. state channels).")]),e._v(" "),a("li",[e._v("A chain reorg can happen after a contract is deployed. If the reorg removes the contract deployment transaction the funds can still be accessed using the private key.")]),e._v(" "),a("li",[e._v("A contract can self desctruct, with the stated intention that ERC20s (or other tokens) in the contract would be burned. However, they can now be accessed by a key for that address.")])]),e._v(" "),a("p",[e._v("All these scenarios are much harder to exploit for an attacker, and likely have much lower yield making the attacks unlikely to be economically viable.")]),e._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[e._v("#")]),e._v(" Backwards Compatibility")]),e._v(" "),a("p",[e._v('It is unlikely that an attack like this has already occurred on the Ethereum mainnet, or we would very likely have heard of it. It is inconceivable that someone would use this as a "feature" to make a contract an EOA at the same time, when they could simply do this by adding some methods to the contract instead of spending billions on building hardware to find hash collisions.')]),e._v(" "),a("p",[e._v("Private networks may have deployed contracts which also work as EOAs at genesis and should check that this upgrade does not impact their workflows.")]),e._v(" "),a("h2",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[e._v("#")]),e._v(" Test Cases")]),e._v(" "),a("p",[e._v("Given a genesis allocation of")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Address: 0x71562b71999873DB5b286dF957af199Ec94617F7\nBalance: 1000000000000000000 // 1 ether\nNonce:   0,\nCode:    0xB0B0FACE",\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("Every transaction send by the private key corresponding to "),a("code",[e._v("0x715656...")]),e._v(" ( "),a("code",[e._v("b71c71a67e1177ad4e901695e1b4b9ee17ae16c6668d313eac2f96dbcda3f291")]),e._v(") fails.")]),e._v(" "),a("p",[e._v("A set of test cases can be found "),a("a",{attrs:{href:"https://github.com/ethereum/tests/pull/879",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1)]),e._v(" "),a("h2",{attrs:{id:"reference-implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference-implementation"}},[e._v("#")]),e._v(" Reference Implementation")]),e._v(" "),a("p",[e._v("The following check must be added to the state transition checks after checking that the nonce of the sender is correct.")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("// Make sure the sender is an EOA\nSet ch to the CodeHash of the sender account\nif cs is not equal to EmptyCodeHash then\n    return ErrSenderNoEOA\nend if\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("An diff to implement EIP-3607 in go-ethereum can be found "),a("a",{attrs:{href:"../../assets/eip-3607/geth.diff"}},[e._v("here")])]),e._v(" "),a("h2",{attrs:{id:"security-considerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations"}},[e._v("#")]),e._v(" Security Considerations")]),e._v(" "),a("p",[e._v("This EIP is a strict security upgrade: It simply makes some transactions that were formerly valid now invalid. There is no legitimate use for such transactions, so there should be no security downsides.")]),e._v(" "),a("p",[e._v("This EIP can be implemented as a soft fork because the new validity rules are a strict superset of the previous validity rules.")]),e._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CC0"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=r.exports}}]);