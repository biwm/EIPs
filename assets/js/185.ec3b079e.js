(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{580:function(t,e,a){"use strict";a.r(e);var s=a(46),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"meta-reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#meta-reference"}},[t._v("#")]),t._v(" Meta reference")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/eip-606.html"}},[t._v("Homestead")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[t._v("#")]),t._v(" Parameters")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("FORK_BLKNUM")]),t._v(" "),a("th",[t._v("CHAIN_NAME")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("1,150,000")]),t._v(" "),a("td",[t._v("Main net")])]),t._v(" "),a("tr",[a("td",[t._v("494,000")]),t._v(" "),a("td",[t._v("Morden")])]),t._v(" "),a("tr",[a("td",[t._v("0")]),t._v(" "),a("td",[t._v("Future testnets")])])])]),t._v(" "),a("h1",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[t._v("#")]),t._v(" Specification")]),t._v(" "),a("p",[t._v("If "),a("code",[t._v("block.number >= HOMESTEAD_FORK_BLKNUM")]),t._v(", do the following:")]),t._v(" "),a("ol",[a("li",[t._v("The gas cost "),a("em",[t._v("for creating contracts via a transaction")]),t._v(" is increased from 21,000 to 53,000, i.e. if you send a transaction and the to address is the empty string, the initial gas subtracted is 53,000 plus the gas cost of the tx data, rather than 21,000 as is currently the case. Contract creation from a contract using the "),a("code",[t._v("CREATE")]),t._v(" opcode is unaffected.")]),t._v(" "),a("li",[t._v("All transaction signatures whose s-value is greater than "),a("code",[t._v("secp256k1n/2")]),t._v(" are now considered invalid. The ECDSA recover precompiled contract remains unchanged and will keep accepting high s-values; this is useful e.g. if a contract recovers old Bitcoin signatures.")]),t._v(" "),a("li",[t._v("If contract creation does not have enough gas to pay for the final gas fee for adding the contract code to the state, the contract creation fails (i.e. goes out-of-gas) rather than leaving an empty contract.")]),t._v(" "),a("li",[t._v("Change the difficulty adjustment algorithm from the current formula: "),a("code",[t._v("block_diff = parent_diff + parent_diff // 2048 * (1 if block_timestamp - parent_timestamp < 13 else -1) + int(2**((block.number // 100000) - 2))")]),t._v(" (where the "),a("code",[t._v("int(2**((block.number // 100000) - 2))")]),t._v(" represents the exponential difficulty adjustment component) to "),a("code",[t._v("block_diff = parent_diff + parent_diff // 2048 * max(1 - (block_timestamp - parent_timestamp) // 10, -99) + int(2**((block.number // 100000) - 2))")]),t._v(", where "),a("code",[t._v("//")]),t._v(" is the integer division operator, eg. "),a("code",[t._v("6 // 2 = 3")]),t._v(", "),a("code",[t._v("7 // 2 = 3")]),t._v(", "),a("code",[t._v("8 // 2 = 4")]),t._v(". The "),a("code",[t._v("minDifficulty")]),t._v(" still defines the minimum difficulty allowed and no adjustment may take it below this.")])]),t._v(" "),a("h1",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[t._v("#")]),t._v(" Rationale")]),t._v(" "),a("p",[t._v("Currently, there is an excess incentive to create contracts via transactions, where the cost is 21,000, rather than contracts, where the cost is 32,000. Additionally, with the help of suicide refunds, it is currently possible to make a simple ether value transfer using only 11,664 gas; the code for doing this is as follows:")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" ethereum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" tester "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" t\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" ethereum "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" s "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abi_contract"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'def init():\\n suicide(0x47e25df8822538a8596b28c637896b4d143c351e)'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endowment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_receipts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gas_used\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11664")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_balance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("normalize_address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x47e25df8822538a8596b28c637896b4d143c351e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000000000000")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("This is not a particularly serious problem, but it is nevertheless arguably a bug.")]),t._v(" "),a("p",[t._v("Allowing transactions with any s value with "),a("code",[t._v("0 < s < secp256k1n")]),t._v(", as is currently the case, opens a transaction malleability concern, as one can take any transaction, flip the s value from "),a("code",[t._v("s")]),t._v(" to "),a("code",[t._v("secp256k1n - s")]),t._v(", flip the v value ("),a("code",[t._v("27 -> 28")]),t._v(", "),a("code",[t._v("28 -> 27")]),t._v("), and the resulting signature would still be valid. This is not a serious security flaw, especially since Ethereum uses addresses and not transaction hashes as the input to an ether value transfer or other transaction, but it nevertheless creates a UI inconvenience as an attacker can cause the transaction that gets confirmed in a block to have a different hash from the transaction that any user sends, interfering with user interfaces that use transaction hashes as tracking IDs. Preventing high s values removes this problem.")]),t._v(" "),a("p",[t._v("Making contract creation go out-of-gas if there is not enough gas to pay for the final gas fee has the benefits that:")]),t._v(" "),a("ul",[a("li",[t._v('(i) it creates a more intuitive "success or fail" distinction in the result of a contract creation process, rather than the current "success, fail, or empty contract" trichotomy;')]),t._v(" "),a("li",[t._v("(ii) makes failures more easily detectable, as unless contract creation fully succeeds then no contract account will be created at all; and")]),t._v(" "),a("li",[t._v("(iii) makes contract creation safer in the case where there is an endowment, as there is a guarantee that either the entire initiation process happens or the transaction fails and the endowment is refunded.")])]),t._v(" "),a("p",[t._v("The difficulty adjustment change conclusively solves a problem that the Ethereum protocol saw two months ago where an excessive number of miners were mining blocks that contain a timestamp equal to "),a("code",[t._v("parent_timestamp + 1")]),t._v("; this skewed the block time distribution, and so the current block time algorithm, which targets a "),a("em",[t._v("median")]),t._v(" of 13 seconds, continued to target the same median but the mean started increasing. If 51% of miners had started mining blocks in this way, the mean would have increased to infinity. The proposed new formula is roughly based on targeting the mean; one can prove that with the formula in use, an average block time longer than 24 seconds is mathematically impossible in the long term.")]),t._v(" "),a("p",[t._v("The use of "),a("code",[t._v("(block_timestamp - parent_timestamp) // 10")]),t._v(" as the main input variable rather than the time difference directly serves to maintain the coarse-grained nature of the algorithm, preventing an excessive incentive to set the timestamp difference to exactly 1 in order to create a block that has slightly higher difficulty and that will thus be guaranteed to beat out any possible forks. The cap of -99 simply serves to ensure that the difficulty does not fall extremely far if two blocks happen to be very far apart in time due to a client security bug or other black-swan issue.")]),t._v(" "),a("h1",{attrs:{id:"implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[t._v("#")]),t._v(" Implementation")]),t._v(" "),a("p",[t._v("This is implemented in Python here:")]),t._v(" "),a("ol",[a("li",[t._v("https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L130")]),t._v(" "),a("li",[t._v("https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L129")]),t._v(" "),a("li",[t._v("https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/processblock.py#L304")]),t._v(" "),a("li",[t._v("https://github.com/ethereum/pyethereum/blob/d117c8f3fd93359fc641fd850fa799436f7c43b5/ethereum/blocks.py#L42")])])])}),[],!1,null,null,null);e.default=n.exports}}]);