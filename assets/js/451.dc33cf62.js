(window.webpackJsonp=window.webpackJsonp||[]).push([[451],{858:function(t,e,a){"use strict";a.r(e);var s=a(46),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[t._v("#")]),t._v(" Simple Summary")]),t._v(" "),a("p",[t._v("A standard interface for gas abstraction in top of smart contracts.")]),t._v(" "),a("p",[t._v("Allows users to offer "),a("RouterLink",{attrs:{to:"/zh/eip-20.html"}},[t._v("EIP-20")]),t._v(" token for paying the gas used in a call.")],1),t._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[t._v("#")]),t._v(" Abstract")]),t._v(" "),a("p",[t._v("A main barrier for adoption of DApps is the requirement of multiple tokens for executing in chain actions. Allowing users to sign messages to show intent of execution, but allowing a third party relayer to execute them can circumvent this problem, while ETH will always be required for ethereum transactions, it's possible for smart contract to take "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(" signatures and forward a payment incentive to an untrusted party with ETH for executing the transaction.")],1),t._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[t._v("#")]),t._v(" Motivation")]),t._v(" "),a("p",[t._v("Standardizing a common format for them, as well as a way in which the user allows the transaction to be paid in tokens, gives app developers a lot of flexibility and can become the main way in which app users interact with the Blockchain.")]),t._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[t._v("#")]),t._v(" Specification")]),t._v(" "),a("h3",{attrs:{id:"methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods"}},[t._v("#")]),t._v(" Methods")]),t._v(" "),a("h4",{attrs:{id:"executegasrelay"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#executegasrelay"}},[t._v("#")]),t._v(" executeGasRelay")]),t._v(" "),a("p",[t._v("Executes "),a("code",[t._v("_execData")]),t._v(" with current "),a("code",[t._v("lastNonce()")]),t._v(" and pays "),a("code",[t._v("msg.sender")]),t._v(" the gas used in specified "),a("code",[t._v("_gasToken")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-solidity line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeGasRelay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _execData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasPrice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasLimit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasRelayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _signature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"executegasrelaymsg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#executegasrelaymsg"}},[t._v("#")]),t._v(" executeGasRelayMsg")]),t._v(" "),a("p",[t._v("Returns the "),a("code",[t._v("executeGasRelay")]),t._v(" message used for signing messages..")]),t._v(" "),a("div",{staticClass:"language-solidity line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeGasRelayMsg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _nonce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" _execData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasPrice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasLimit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasRelayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"executegasrelayerc191msg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#executegasrelayerc191msg"}},[t._v("#")]),t._v(" executeGasRelayERC191Msg")]),t._v(" "),a("p",[t._v("Returns the "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(" of "),a("code",[t._v("executeGasRelayMsg")]),t._v(" used for signing messages and for verifying the execution.")],1),t._v(" "),a("div",{staticClass:"language-solidity line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeGasRelayERC191Msg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _nonce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" _execData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasPrice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" _gasLimit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _gasRelayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"lastnonce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lastnonce"}},[t._v("#")]),t._v(" lastNonce")]),t._v(" "),a("p",[t._v("Returns the current nonce for the gas relayed messages.")]),t._v(" "),a("div",{staticClass:"language-solidity line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lastNonce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" nonce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"signed-message"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signed-message"}},[t._v("#")]),t._v(" Signed Message")]),t._v(" "),a("p",[t._v("The signed message require the following fields:")]),t._v(" "),a("ul",[a("li",[t._v("Nonce: A nonce "),a("em",[t._v("or")]),t._v(" a timestamp;")]),t._v(" "),a("li",[t._v("Execute Data: the bytecode to be executed by the account contract;")]),t._v(" "),a("li",[t._v("Gas Price: The gas price (paid in the selected token);")]),t._v(" "),a("li",[t._v("Gas Limit: The gas reserved to the relayed execution;")]),t._v(" "),a("li",[t._v("Gas Token: A token in which the gas will be paid (leave 0 for ether);")]),t._v(" "),a("li",[t._v("Gas Relayer: the beneficiary of gas refund for this call (leave 0 for "),a("code",[t._v("block.coinbase")]),t._v(") .")])]),t._v(" "),a("h4",{attrs:{id:"signing-the-message"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signing-the-message"}},[t._v("#")]),t._v(" Signing the message")]),t._v(" "),a("p",[t._v("The message "),a("strong",[t._v("MUST")]),t._v(" be signed as "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(" standard, and the called contract "),a("strong",[t._v("MUST")]),t._v(" also implement "),a("RouterLink",{attrs:{to:"/zh/eip-1271.html"}},[t._v("EIP-1271")]),t._v(" which must validate the signed messages.")],1),t._v(" "),a("p",[t._v("Messages "),a("strong",[t._v("MUST")]),t._v(" be signed by the owner of the account contract executing. If the owner is a contract, it must implement "),a("RouterLink",{attrs:{to:"/zh/eip-1271.html"}},[t._v("EIP-1271")]),t._v(" interface and forward validation to it.")],1),t._v(" "),a("p",[t._v("In order to be compliant, the transaction "),a("strong",[t._v("MUST")]),t._v(' request to sign a "messageHash" that is a concatenation of multiple fields.')]),t._v(" "),a("p",[t._v("The fields "),a("strong",[t._v("MUST")]),t._v(" be constructed as this method:")]),t._v(" "),a("p",[t._v("The first and second fields are to make it "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(" compliant. Starting a transaction with "),a("code",[t._v("byte(0x19)")]),t._v(" ensure the signed data from being a "),a("a",{attrs:{href:"https://github.com/ethereum/wiki/wiki/RLP",target:"_blank",rel:"noopener noreferrer"}},[t._v("valid ethereum transaction"),a("OutboundLink")],1),t._v(". The second argument is a version control byte. The third being the validator address (the account contract address) according to version 0 of "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(". The remaining arguments being the application specific data for the gas relay: chainID as per "),a("RouterLink",{attrs:{to:"/zh/eip-1344.html"}},[t._v("EIP-1344")]),t._v(", execution nonce, execution data, agreed gas Price, gas limit of gas relayed call, gas token to pay back and gas relayer authorized to receive reward.")],1),t._v(" "),a("p",[t._v("The "),a("RouterLink",{attrs:{to:"/zh/eip-191.html"}},[t._v("EIP-191")]),t._v(" message must be constructed as following:")],1),t._v(" "),a("div",{staticClass:"language-solidity line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("keccak256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    abi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodePacked")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ERC-191 - the initial 0x19 byte")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ERC-191 - the version byte")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ERC-191 - version data (validator address)")]),t._v("\n        chainID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("keccak256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"executeGasRelay(uint256,bytes,uint256,uint256,address,address)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _nonce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        _execData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _gasPrice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _gasLimit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _gasToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        _gasRelayer\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[t._v("#")]),t._v(" Rationale")]),t._v(" "),a("p",[t._v("User pain points:")]),t._v(" "),a("ul",[a("li",[t._v("users don't want to think about ether")]),t._v(" "),a("li",[t._v("users don't want to think about backing up private keys or seed phrases")]),t._v(" "),a("li",[t._v("users want to be able to pay for transactions using what they already have on the system, be apple pay, xbox points or even a credit card")]),t._v(" "),a("li",[t._v("Users don’t want to sign a new transaction at every move")]),t._v(" "),a("li",[t._v("Users don’t want to download apps/extensions (at least on the desktop) to connect to their apps")])]),t._v(" "),a("p",[t._v("App developer pain points:")]),t._v(" "),a("ul",[a("li",[t._v("Many apps use their own token and would prefer to use those as the main accounting")]),t._v(" "),a("li",[t._v("Apps want to be able to have apps in multiple platforms without having to share private keys between devices or have to spend transaction costs moving funds between them")]),t._v(" "),a("li",[t._v("Token developers want to be able for their users to be able to move funds and pay fees in the token")]),t._v(" "),a("li",[t._v("While the system provides fees and incentives for miners, there are no inherent business model for wallet developers (or other apps that initiate many transactions)")])]),t._v(" "),a("p",[t._v("Using signed messages, specially combined with an account contract that holds funds, and multiple disposable ether-less keys that can sign on its behalf, solves many of these pain points.")]),t._v(" "),a("h3",{attrs:{id:"multiple-signatures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multiple-signatures"}},[t._v("#")]),t._v(" Multiple signatures")]),t._v(" "),a("p",[t._v("More than one signed transaction with the same parameter can be executed by this function at the same time, by passing all signatures in the "),a("code",[t._v("messageSignatures")]),t._v(" field. That field will split the signature in multiple 72 character individual signatures and evaluate each one. This is used for cases in which one action might require the approval of multiple parties, in a single transaction.")]),t._v(" "),a("p",[t._v("If multiple signatures are required, then all signatures should then be "),a("em",[t._v("ordered by account")]),t._v(" and the account contract should implement signatures checks locally ("),a("code",[t._v("JUMP")]),t._v(") on "),a("RouterLink",{attrs:{to:"/zh/eip-1271.html"}},[t._v("EIP-1271")]),t._v(" interface which might forward ("),a("code",[t._v("STATIC_CALL")]),t._v(") the "),a("RouterLink",{attrs:{to:"/zh/eip-1271.html"}},[t._v("EIP-1271")]),t._v(" signature check to owner contract.")],1),t._v(" "),a("h3",{attrs:{id:"keep-track-of-nonces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keep-track-of-nonces"}},[t._v("#")]),t._v(" Keep track of nonces:")]),t._v(" "),a("p",[t._v("Note that "),a("code",[t._v("executeGasRelay")]),t._v(" function does not take a "),a("code",[t._v("_nonce")]),t._v(" as parameter. The contract knows what is the current nonce, and can only execute the transactions in order, therefore there is no reason")]),t._v(" "),a("p",[t._v("Nonces work similarly to normal ethereum transactions: a transaction can only be executed if it matches the last nonce + 1, and once a transaction has occurred, the "),a("code",[t._v("lastNonce")]),t._v(" will be updated to the current one. This prevents transactions to be executed out of order or more than once.")]),t._v(" "),a("p",[t._v("Contracts may accept transactions without nonce (nonce = 0). The contract then must keep the full hash of the transaction to prevent it from being replayed. This would allows contracts to have more flexibilities as you can sign a transaction that can be executed out of order or not at all, but it uses more memory for each transaction. It can be used, for instance, for transactions that the user wants to schedule in the future but cannot know its future nonce, or transactions that are made for state channel contracts that are not guaranteed to be executed or are only executed when there's some dispute.")]),t._v(" "),a("h3",{attrs:{id:"execute-transaction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execute-transaction"}},[t._v("#")]),t._v(" Execute transaction")]),t._v(" "),a("p",[t._v("After signature validation, the evaluation of "),a("code",[t._v("_execBytes")]),t._v(" is up to the account contract implementation, it's role of the wallet to properly use the account contract and it's gas relay method. A common pattern is to expose an interface which can be only called by the contract itself. The "),a("code",[t._v("_execBytes")]),t._v(" could entirely forward the call in this way, as example: "),a("code",[t._v("address(this).call.gas(_gasLimit)(_execData);")]),t._v(" Where "),a("code",[t._v("_execData")]),t._v(" could call any method of the contract itself, for example:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("call(address to, uint256 value, bytes data)")]),t._v(":  allow any type of ethereum call be performed;")]),t._v(" "),a("li",[a("code",[t._v("create(uint256 value, bytes deployData)")]),t._v(": allows create contract")]),t._v(" "),a("li",[a("code",[t._v("create2(uint256 value, bytes32 salt, bytes deployData)")]),t._v(": allows create contract with deterministic address")]),t._v(" "),a("li",[a("code",[t._v("approveAndCall(address token, address to, uint256 value, bytes data)")]),t._v(": allows safe approve and call of an ERC20 token.")]),t._v(" "),a("li",[a("code",[t._v("delegatecall(address codeBase, bytes data)")]),t._v(": allows executing code stored on other contract")]),t._v(" "),a("li",[a("code",[t._v("changeOwner(address newOwner)")]),t._v(": Some account contracts might allow change of owner")]),t._v(" "),a("li",[a("code",[t._v("foo(bytes bar)")]),t._v(": Some account contracts might have custom methods of any format.")])]),t._v(" "),a("p",[t._v("The standardization of account contracts is not scope of this ERC, and is presented here only for illustration on possible implementations. Using a self call to evaluate "),a("code",[t._v("_execBytes")]),t._v(" is not mandatory, depending on the account contract logic, the evaluation could be done locally.")]),t._v(" "),a("h3",{attrs:{id:"gas-accounting-and-refund"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gas-accounting-and-refund"}},[t._v("#")]),t._v(" Gas accounting and refund")]),t._v(" "),a("p",[t._v("The implementing contract must keep track of the gas spent. One way to do it is to first call "),a("code",[t._v("gasLeft()")]),t._v(" at the beginning of the function and then after executing the desired action and compare the difference.")]),t._v(" "),a("p",[t._v("The contract then will make a token transfer (or ether, if "),a("code",[t._v("tokenAddress")]),t._v(" is nil) in the value of "),a("code",[t._v("gasSpent * gasPrice")]),t._v(" to the "),a("code",[t._v("_gasRelayer")]),t._v(", that is the account that deployed the message.")]),t._v(" "),a("p",[t._v("If "),a("code",[t._v("_gasRelayer")]),t._v(" is zero, then the funds "),a("strong",[t._v("MUST")]),t._v(" go to "),a("code",[t._v("block.coinbase")]),t._v(".")]),t._v(" "),a("p",[t._v("If there are not enough funds, or if the total surpasses "),a("code",[t._v("gasLimit")]),t._v(" then the transaction "),a("strong",[t._v("MUST")]),t._v(" revert.")]),t._v(" "),a("p",[t._v("If the executed transaction fails internally, nonces should still be updated and gas needs to be paid.")]),t._v(" "),a("p",[t._v("Contracts are not obligated to support ether or any other token they don’t want and can be implemented to only accept refunds in a few tokens of their choice.")]),t._v(" "),a("h3",{attrs:{id:"usage-examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage-examples"}},[t._v("#")]),t._v(" Usage examples")]),t._v(" "),a("p",[t._v("This scheme opens up a great deal of possibilities on interaction as well as different experiments on business models:")]),t._v(" "),a("ul",[a("li",[t._v("Apps can create individual identities contract for their users which holds the actual funds and then create a different private key for each device they log into. Other apps can use the same identity and just ask to add permissioned public keys to manage the device, so that if one individual key is lost, no ether is lost.")]),t._v(" "),a("li",[t._v("An app can create its own token and only charge their users in its internal currency for any ethereum transaction. The currency units can be rounded so it looks more similar to to actual amount of transactions: a standard transaction always costs 1 token, a very complex transaction costs exactly 2, etc. Since the app is the issuer of the transactions, they can do their own Sybil verifications and give a free amount of currency units to new users to get them started.")]),t._v(" "),a("li",[t._v("A game company creates games with a traditional monthly subscription, either by credit card or platform-specific microtransactions. Private keys never leave the device and keep no ether and only the public accounts are sent to the company. The game then signs transactions on the device with gas price 0, sends them to the game company which checks who is an active subscriber and batches all transactions and pays the ether themselves. If the company goes bankrupt, the gamers themselves can set up similar subscription systems or just increase the gas price. End result is a "),a("strong",[t._v("ethereum based game in which gamers can play by spending apple, google or xbox credits")]),t._v(".")]),t._v(" "),a("li",[t._v("A standard token is created that doesn’t require its users to have ether, and instead allows tokens to be transferred by paying in tokens. A wallet is created that signs messages and send them via whisper to the network, where other nodes can compete to download the available transactions, check the current gas price, and select those who are paying enough tokens to cover the cost. "),a("strong",[t._v("The result is a token that the end users never need to keep any ether and can pay fees in the token itself.")])]),t._v(" "),a("li",[t._v("A DAO is created with a list of accounts of their employees. Employees never need to own ether, instead they sign messages, send them to whisper to a decentralized list of relayers which then deploy the transactions. The DAO contract then checks if the transaction is valid and sends ether to the deployers. Employees have an incentive not to use too many of the companies resources because they’re identifiable.  The result is that the users of the DAO don't need to keep ether, and "),a("strong",[t._v("the contract ends up paying for it's own gas usage")]),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[t._v("#")]),t._v(" Backwards Compatibility")]),t._v(" "),a("p",[t._v("There is no issues with backwards compatibility, however for future upgrades, as "),a("code",[t._v("_execData")]),t._v(" contains arbitrary data evaluated by the account contract, it's up to the contract to handle properly this data and therefore contracts can gas relay any behavior with the current interface.")]),t._v(" "),a("h2",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[t._v("#")]),t._v(" Test Cases")]),t._v(" "),a("p",[t._v("TBD")]),t._v(" "),a("h2",{attrs:{id:"implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[t._v("#")]),t._v(" Implementation")]),t._v(" "),a("p",[t._v("One initial implementation of such a contract can be found at "),a("a",{attrs:{href:"https://github.com/status-im/account-contracts/blob/develop/contracts/account/AccountGasAbstract.sol",target:"_blank",rel:"noopener noreferrer"}},[t._v("Status.im account-contracts repository"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Other version is implemented as Gnosis Safe variant in: https://github.com/status-im/safe-contracts")]),t._v(" "),a("h3",{attrs:{id:"similar-implementations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#similar-implementations"}},[t._v("#")]),t._v(" Similar implementations")]),t._v(" "),a("p",[t._v("The idea of using signed messages as executable intent has been around for a while and many other projects are taking similar approaches, which makes it a great candidate for a standard that guarantees interoperability:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/ethereum/EIPs/pull/877",target:"_blank",rel:"noopener noreferrer"}},[t._v("EIP-877"),a("OutboundLink")],1),t._v(" An attempt of doing the same but with a change in the protocol")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/status-im/ideas/issues/73",target:"_blank",rel:"noopener noreferrer"}},[t._v("Status"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/aragonlabs/pay-protocol",target:"_blank",rel:"noopener noreferrer"}},[t._v("Aragon"),a("OutboundLink")],1),t._v(" (this might not be the best link to show their work in this area)")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ethereum/EIPs/issues/662",target:"_blank",rel:"noopener noreferrer"}},[t._v("Token Standard Functions for Preauthorized Actions"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ethereum/EIPs/issues/865",target:"_blank",rel:"noopener noreferrer"}},[t._v("Token Standard Extension 865"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/iurimatias/TransactionRelay",target:"_blank",rel:"noopener noreferrer"}},[t._v("Iuri Matias: Transaction Relay"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/uport-project/uport-identity#send-a-meta-tx",target:"_blank",rel:"noopener noreferrer"}},[t._v("uPort: Meta transactions"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/uport-project/uport-identity/blob/develop/docs/txRelay.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("uPort: safe Identities"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/gnosis/safe-contracts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gnosis safe contracts"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("Swarm city uses a similar proposition for etherless transactions, called "),a("a",{attrs:{href:"https://github.com/swarmcity/SCLabs-gasstation-service",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gas Station Service"),a("OutboundLink")],1),t._v(", but it's a different approach. Instead of using signed messages, a traditional ethereum transaction is signed on an etherless account, the transaction is then sent to a service that immediately sends the exact amount of ether required and then publishes the transaction.")]),t._v(" "),a("h2",{attrs:{id:"security-considerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations"}},[t._v("#")]),t._v(" Security Considerations")]),t._v(" "),a("p",[t._v("Deployers of transactions (relayers) should be able to call untrusted contracts, which provides no guarantees that the contract they are interacting with correctly implements the standard and they will be reimbursed for gas. To prevent being fooled by bad implementations, relayers must "),a("strong",[t._v("estimate the outcome of a transaction")]),t._v(", and only include/sign transactions which have a desired outcome.")]),t._v(" "),a("p",[t._v("Is also interest of relayers to maintaining a private reputation of contracts they interact with, as well as keep track of which tokens and for which "),a("code",[t._v("gasPrice")]),t._v(" they’re willing to deploy transactions.")]),t._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[t._v("#")]),t._v(" Copyright")]),t._v(" "),a("p",[t._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CC0"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.youtube.com/watch?v=qF2lhJzngto",target:"_blank",rel:"noopener noreferrer"}},[t._v("Universal Logins talk at UX Unconf, Toronto"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);